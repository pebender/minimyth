diff -Naur mysql-4.1.22-old/configure.in mysql-4.1.22-new/configure.in
--- mysql-4.1.22-old/configure.in	2006-11-02 18:15:41.000000000 -0800
+++ mysql-4.1.22-new/configure.in	2006-11-28 20:16:56.000000000 -0800
@@ -261,6 +261,9 @@
 AC_MSG_CHECKING("return type of sprintf")
 
 #check the return type of sprintf
+if test "${mysql_sprintf_return_type+set}" = set ; then
+   AC_MSG_RESULT("(cached) ${mysql_sprintf_return_type}")
+else
 case $SYSTEM_TYPE in
   *netware*)
     AC_DEFINE(SPRINTF_RETURNS_INT, [1]) AC_MSG_RESULT("int")
@@ -277,7 +280,7 @@
       return -1;
      }
    ],
-   [AC_DEFINE(SPRINTF_RETURNS_INT, [1], [POSIX sprintf])
+   [mysql_sprintf_return_type="int"
    AC_MSG_RESULT("int")],
    [AC_TRY_RUN([
  int main()
@@ -288,13 +291,21 @@
        return 0;
      return -1;
    }           ],
-               [AC_DEFINE(SPRINTF_RETURNS_PTR, [1], [Broken sprintf])
+               [mysql_sprintf_return_type="ptr"
                 AC_MSG_RESULT("ptr")],
-               [AC_DEFINE(SPRINTF_RETURNS_GARBAGE, [1], [Broken sprintf])
+               [mysql_sprintf_return_type="garbage"
                 AC_MSG_RESULT("garbage")])
    ])
     ;;
 esac
+fi
+if   test "x${mysql_sprintf_return_type}" = "xint" ; then
+  AC_DEFINE(SPRINTF_RETURNS_INT, [1], [POSIX sprintf])
+elif test "x${mysql_sprintf_return_type}" = "xptr" ; then
+  AC_DEFINE(SPRINTF_RETURNS_PTR, [1], [Broken sprintf])
+else
+  AC_DEFINE(SPRINTF_RETURNS_GARBAGE, [1], [Broken sprintf])
+fi
 
 
 # option, cache_name, variable,
@@ -884,31 +895,29 @@
   AC_LANG_CPLUSPLUS
 
   atom_ops=
-  AC_TRY_RUN([
+  AC_TRY_LINK([
 #include <asm/atomic.h>
-int main()
-{
+  ],
+  [
   atomic_t v;
 
   atomic_set(&v, 23);
   atomic_add(5, &v);
   return atomic_read(&v) == 28 ? 0 : -1;
-}
   ],
   [AC_DEFINE([HAVE_ATOMIC_ADD], [1],
              [atomic_add() from <asm/atomic.h> (Linux only)])
    atom_ops="${atom_ops}atomic_add "],
   )
-  AC_TRY_RUN([
+  AC_TRY_LINK([
 #include <asm/atomic.h>
-int main()
-{
+  ],
+  [
   atomic_t v;
 
   atomic_set(&v, 23);
   atomic_sub(5, &v);
   return atomic_read(&v) == 18 ? 0 : -1;
-}
   ],
   [AC_DEFINE([HAVE_ATOMIC_SUB], [1],
              [atomic_sub() from <asm/atomic.h> (Linux only)])
@@ -977,7 +986,7 @@
     AC_MSG_RESULT([no])
     ;;
   *)
-AC_TRY_RUN([
+AC_TRY_COMPILE([
 #ifdef HAVE_STDLIB_H
 #include <stdlib.h>
 #endif
@@ -989,12 +998,10 @@
 #ifdef HAVE_SYS_TYPES_H
 #include <sys/types.h>
 #endif
-
-int main()
-{
+],
+[
   int8 i;
   return 0;
-}
 ],
 [AC_DEFINE([HAVE_INT_8_16_32], [1],
            [whether int8, int16 and int32 types exist])
