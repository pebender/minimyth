diff -Naur libX11-1.2.1-old/configure.ac libX11-1.2.1-new/configure.ac
--- libX11-1.2.1-old/configure.ac	2009-04-07 15:18:30.000000000 -0700
+++ libX11-1.2.1-new/configure.ac	2009-06-12 08:45:52.000000000 -0700
@@ -49,8 +49,18 @@
 case "$ac_cv_use_xcb" in
 no)
 	X11_REQUIRES="xau xcmiscproto bigreqsproto"
-	X11_EXTRA_DEPS="xau xdmcp"
-	PKG_CHECK_MODULES(XDMCP, xdmcp)
+ 	X11_EXTRA_DEPS="xau"
+ 	PKG_CHECK_MODULES(XDMCP, xdmcp,
+ 		AC_CHECK_LIB(Xdmcp, XdmcpWrap,
+ 			[
+ 	        	AC_CHECK_LIB(Xdmcp, XdmcpWrap, [xdmauth="yes"], [xdmauth="no"], [$XDMCP_LIBS])
+ 	        	X11_EXTRA_DEPS="$X11_EXTRA_DEPS xdmcp"
+ 			],
+ 			[
+ 			XDMCP_CFLAGS=
+ 			XDMCP_LIBS=
+ 			], [$XDMCP_LIBS]),
+ 		[AC_MSG_RESULT(no)])
 	AC_CHECK_LIB(Xdmcp, XdmcpWrap, [xdmauth="yes"], [xdmauth="no"], [$XDMCP_LIBS])
 	AC_DEFINE(USE_XCB, 0, [Use XCB for low-level protocol implementation])
 	;;
diff -Naur libX11-1.2.1-old/src/ConnDis.c libX11-1.2.1-new/src/ConnDis.c
--- libX11-1.2.1-old/src/ConnDis.c	2008-11-18 22:42:01.000000000 -0800
+++ libX11-1.2.1-new/src/ConnDis.c	2009-06-12 08:43:34.000000000 -0700
@@ -39,7 +39,9 @@
 #include <X11/Xlibint.h>
 #include <X11/Xtrans/Xtrans.h>
 #include <X11/Xauth.h>
+#ifdef HASXDMAUTH
 #include <X11/Xdmcp.h>
+#endif
 #include <stdio.h>
 #include <ctype.h>
 #include <unistd.h>
