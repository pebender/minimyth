#!/bin/sh
################################################################################
# mm_conf_get
################################################################################
[ -n "`mm_var_get MM_DEBUG`" ] && set -x

REMOTE_FILE=$1
LOCAL_FILE=$2

MM_TFTP_SERVER=`mm_var_get MM_TFTP_SERVER`
MM_TFTP_ROOTDIR=`mm_var_get MM_TFTP_ROOTDIR`

LOCAL_DIR=`echo ${LOCAL_FILE} | sed -e 's%[^/]*$%%' -e 's%/$%%'`
[ -n "${LOCAL_DIR}" ] && mkdir -p ${LOCAL_DIR}

TMP_FILE=${LOCAL_FILE}~

rm -f ${TMP_FILE}
FILE_GOT=0
[ ${FILE_GOT} = 0 ] && 
    tftp -g -r ${MM_TFTP_ROOTDIR}/conf/`hostname`/${REMOTE_FILE} -l ${TMP_FILE} ${MM_TFTP_SERVER} && FILE_GOT=1
[ ${FILE_GOT} = 0 ] && 
    tftp -g -r ${MM_TFTP_ROOTDIR}/conf/${REMOTE_FILE}            -l ${TMP_FILE} ${MM_TFTP_SERVER} && FILE_GOT=1
[ ${FILE_GOT} = 1 ] && 
    mv -f ${TMP_FILE} ${LOCAL_FILE}
rm -f ${TMP_FILE}
