#!/bin/sh

name="$1"
action="$2"

mountpoint_remove()
{
    name="$1"
    symlink="$2"

    umount -l /media/${symlink} || true
    rmdir /media/${symlink}
}

mountpoint_add()
{
    name="$1"
    symlink="$2"

    mkdir -p /media/${symlink}
    case ${name} in
        hd[a-z])
            ;;
        sd[a-z])
            mount -t auto /dev/${symlink} /media/${symlink} || true
            ;;
        sr[0-9]*)
            ;;
    esac
}

case ${action} in
    add)
        symlinks="${DEVLINKS}"
        for symlink in ${symlinks} ; do
            symlink=`echo ${symlink} | sed 's%//*%/%g' | sed 's%^/dev/%%'`
            mountpoint_remove "${name}" "${symlink}"
            mountpoint_add    "${name}" "${symlink}"
        done
        ;;
    remove)
        symlinks="${DEVLINKS}"
        for symlink in ${symlinks} ; do
            symlink=`echo ${symlink} | sed 's%//*%/%g' | sed 's%^/dev/%%'`
            mountpoint_remove "${name}" "${symlink}"
        done
        ;;
esac
