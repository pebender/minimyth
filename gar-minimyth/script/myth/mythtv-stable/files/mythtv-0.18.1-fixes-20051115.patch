diff -Naur mythtv-0.18.1-old/contrib/trailer.pl mythtv-0.18.1-new/contrib/trailer.pl
--- mythtv-0.18.1-old/contrib/trailer.pl	2005-03-13 10:04:24.000000000 -0800
+++ mythtv-0.18.1-new/contrib/trailer.pl	2005-11-19 07:20:36.000000000 -0800
@@ -1,266 +1,266 @@
-#!/usr/bin/perl -w
-# Author: Andrei Rjeousski ( arjeousski at gmail com )
-# Version 0.6
-# Changes:
-# 0.1
-#  Initial release
-# 0.2
-#  Added more handling to linked .mov files
-# 0.3
-#  Searching trailer pages that dont have "large" or "high" in them
-# 0.4
-#  If nothing is found based on IMDB title, try looking for movie's short title
-# 0.5
-#  If apple.com doesnt return anything, try googling it :)
-# 0.6
-#  Updated and added more recognition in getting the large trailer from a page with choices of small/med/large
-
-use LWP::Simple;      # libwww-perl providing simple HTML get actions
-use HTML::Entities;
-use URI::Escape;
-
-
-
-use vars qw($opt_r $opt_d $opt_T);
-use Getopt::Std; 
-
-
-# display usage
-sub usage {
-   print "usage: $0 \n";
-   print "       -T <movieid>  get movie trailer\n";
-   print "       -d enable debug";
-   exit(-1);
-}
-
-# returns text within 'data' between 'beg' and 'end' matching strings (taken from imdb.pl)
-sub parseBetween {
-   my ($data, $beg, $end)=@_; # grab parameters
-
-   my $ldata = lc($data);
-   my $start = index($ldata, lc($beg)) + length($beg);
-   my $finish = index($ldata, lc($end), $start);
-   if ($start != (length($beg) -1) && $finish != -1) {
-      my $result = substr($data, $start, $finish - $start);
-      # return w/ decoded numeric character references
-      # (see http://www.w3.org/TR/html4/charset.html#h-5.3.1)
-      decode_entities($result);
-      return $result;
-   }
-   return "";
-}
-
-sub getTrailerURL {
-   my ($movieid) = @_;
-   
-   # get the name of the movie
-   my $host = "http://www.imdb.com/title/tt" . $movieid . "/";
-   my $response = get $host;
-
-   # get the title
-   my $movie_title = parseBetween($response, "<title>", "<\/title>");
-
-   $response =~ /<br>([\w\s\(\)^<^>]+)\S+?\(short title\)/i;
-   my $short_movie_title = "";
-   $short_movie_title = $1 if ($1);
-
-
-   # get rid of the year
-   $movie_title =~ s/\ *\(.+?\)//xig;
-   $movie_title =~ s/\ *,\ *(The|A)$//xgi;
-   $movie_title =~ s/\&//ig;
-
-   # get rid of the year
-   $short_movie_title =~ s/\ *\(.+?\)//xig;
-   $short_movie_title =~ s/\ *,\ *(The|A)$//xgi;
-   $short_movie_title =~ s/\&//ig;
-   
-   if (defined $opt_d) { printf("# looking for movie id: $movieid title: $movie_title short title: $short_movie_title\n"); }
-   
-   # add pluses
-   my $movie_title_plus = $movie_title;
-   $movie_title_plus =~ tr/ /+/;
-   my $short_movie_title_plus = $short_movie_title;
-   $short_movie_title_plus =~ tr/ /+/;    
-   
-   my $found = 0;
-   my $search_string = $movie_title_plus;   
-   my $trailer_page_uri = "";    
-
-   while (!$found) {
-       if (defined $opt_d) { printf("# looking for: $search_string\n"); }
-       # do the search
-       $host = "http://searchcgi.apple.com/cgi-bin/sp/nph-searchpre1.pl?q=".$search_string."+site:www.apple.com/trailers&restrict=us_trailers_only&client=www_collection&site=www_collection&lr=lang_en&output=xml&sort=&filter=0&access=p";
-       $response = get $host;
-       
-           # find URL with "large"
-           if ($trailer_page_uri eq "") {
-                   if ($response =~ m/\"(http:\/\/.*large.*)\"/i) {
-                           $trailer_page_uri = $1;
-                           if (defined $opt_d) { printf("# found large\n"); }
-                   }
-           }
-   
-           # check for high
-           if ($trailer_page_uri eq "") {
-                   if ($response =~ m/\"(http:\/\/(.*high.*))\"/i) {
-                           $trailer_page_uri = $1; 
-                           if (defined $opt_d) { printf("# found high\n"); }
-                   } 
-           }
-   
-           # must not have "large" or "high"
-           if ($trailer_page_uri eq "") {
-                   if ($response =~ m/href=\"(http:\/\/[\w.\/]+)\">(Apple - Trailers)[^<]+/i) {
-                           $trailer_page_uri = $1;
-                           if (defined $opt_d) { printf("# found other\n"); }
-                   } 
-           }
-           
-           # check for "large" in the title
-           if ($trailer_page_uri eq "") {
-                   if ($response =~ m/<a.*?href=\"([^\"]*)\"[^>]*?>.*?large.*?<\/a>/i) {
-                           $trailer_page_uri = $1;
-                           if (defined $opt_d) { printf("# found title - large\n"); }
-                   }
-           }	
-   
-           # we must be at the studios page
-           if ($trailer_page_uri =~ m/\/$/) {
-                   if (defined $opt_d) { printf("# didnt find the movie, found studio: $trailer_page_uri\n"); }
-                   # look for a movie
-                   $response =~ /href=\"([^"]+)\"[^>]*>.*?<b>.*?<\/a>/i;
-                   $trailer_page_uri = $1;
-   
-                   # search for a partial match, if the movie is on the studios page, movie must be here
-                   if (defined($trailer_page_uri)) {
-                           if (defined $opt_d) { printf("# new trailer page: $trailer_page_uri\n"); }
-   
-                           # get the actual page
-                           $response = get $trailer_page_uri;
-                           if (
-                               $response =~ m/<a.*?href=\"([^\"]*)\"[^>]*?>.*?large/i || # large in image name after A
-                               $response =~ m/<a.*?href=\"([^\"]*)\"[^>]*?large[^>]*?>/i || # large within javascript
-                               $response =~ m/\"(.*large[^\"]*)\"/i || # large in actual filename
-                               $response =~ m/\"([^<>\"]*?high[^\"<>]*?)\"/i || # high in filename
-                               $response =~ m/<a.*?href=\"([^\"]*)\"[^>]*?>.*?high/i || # high  after A
-                               $response =~ m/\"([^\"]*?lrg[^\"]*?)\"/i ||  #lrg in filename
-                               $response =~ m/\"([^\"]*?_lg.[^\"]*?)\"/i || #_lg. in filename
-                               $response =~ m/\"([^\"]*?480[^\"]*?)\"/i # 480 in filename
-                               ) {
-									# m/\"([^\"]*?high[^\"]*?)\"/i - gangs of new york
-                                   if (defined $opt_d) { printf("# found large trailer\n"); }
-                                   $trailer_page_uri .= $1;
-                           } else {
-                              $trailer_page_uri = "";
-                           }
-                   } else {
-                           $trailer_page_uri = "";
-                   }
-           }
-           if ($trailer_page_uri eq "" and $short_movie_title ne "" and !$found and $search_string ne $short_movie_title_plus) {
-               $search_string = $short_movie_title_plus;
-               
-           } else {
-               $found = 1;
-           }
-   }
-
-    
-   # lets try googling (cant merge with above code yet)
-   if ($trailer_page_uri eq "") {
-      if (defined $opt_d) { printf("# googling for: $movie_title_plus\n"); }
-     
-      # google requires the following hack, otherwise it give 403 (try googling a seach page with wget)
-      require LWP::UserAgent;
-      
-      my $ua = LWP::UserAgent->new;
-      # gotta trick google     
-      $ua->agent('Mozilla/5.0');
-      
-      $response = $ua->get("http://www.google.com/search?hl=en&ie=UTF-8&q=$movie_title_plus+site:www.apple.com");
-      $response = $response->content;
- 
-      # must not have "large" or "high"
-      if ($trailer_page_uri eq "") {
-              if ($response =~ m/href=(http:\/\/[\w.\/]+)[^>]*?>(Apple - Trailers)[^<]+/i) {
-                      $trailer_page_uri = $1;
-                      if (defined $opt_d) { printf("# googled other\n"); }
-              } 
-      }
-            
-   }
-    
-    
-    
-    my $trailer_uri = "";
-    #only proceed, if something was found
-    if ($trailer_page_uri ne "") {
-        if (defined $opt_d) { printf("# trailer page found: $trailer_page_uri\n"); }
-        
-	# get the trailer page
-	$response = get $trailer_page_uri;
-	$response = lc($response);
-
-	if (defined $opt_r) { printf($response); }
-        
-	# try parsing...
-	$trailer_uri = parseBetween($response,"name=\"href\" value=\"","\"") if ($trailer_uri eq "");
-	$trailer_uri = parseBetween($response,"controller=\"false\" href=\"","\"") if ($trailer_uri eq "");
-	$trailer_uri = parseBetween($response,"target=\"myself\" src=\"","\"") if ($trailer_uri eq "");
-	$trailer_uri = parseBetween($response,"controller=\"true\" src=\"","\"") if ($trailer_uri eq "");
-	$trailer_uri = parseBetween($response,"param name=\"src\" value=\"","\"") if ($trailer_uri eq "");	
-
-	# now we need to get the filename of the ACTUAL file
-	if ($trailer_uri ne "") {
-            if (defined $opt_d) { printf("# actual trailer found: $trailer_uri\n"); }
-            if (defined $opt_d) { printf("# starting to download\n"); }
-	
-	    my $file_size = 0; 	
-	    while ($file_size < 100000) {
-		    my @headers = head $trailer_uri;
-		    $file_size = $headers[1];
-	    	
-            	    if ($file_size < 100000) { # to be save
-			    my $file = get $trailer_uri;
-
-	    		    $file =~ /(.*\.mov.*)*url.{5}([\w-]+.mov).*$/is;
-		       	    $file = $2;
-       
-		            if (defined $opt_d) { printf("# actual filename is $file\n"); }
-        		    $trailer_uri =~ s/[^\/]+.mov$/$file/gi;
-		    }
-	    }
-            
-            if (defined $opt_d) { printf("# final trailer uri is $trailer_uri\n"); }
-        }
-    }
-	return $trailer_uri;
-}
-
-
-
-#
-# Main Program
-#
-
-# parse command line arguments 
-getopts('drT');
-
-# print out usage if needed
-if ($#ARGV<0) { usage(); }
-
-if (defined $opt_T) {
-   # take movieid from cmdline arg
-   $movieid = shift || die "Usage : $0 -T <movieid>\n";
-   my $trailer_uri = getTrailerURL($movieid);
-   #if (defined $opt_d) {
-      printf("$trailer_uri\n");
-   #}
-#   if ($trailer_uri ne "") {
-#	   system "wget -O $movieid.mov $trailer_uri"; 
-#   }   
-}
-
-
-
+#!/usr/bin/perl -w
+# Author: Andrei Rjeousski ( arjeousski at gmail com )
+# Version 0.6
+# Changes:
+# 0.1
+#  Initial release
+# 0.2
+#  Added more handling to linked .mov files
+# 0.3
+#  Searching trailer pages that dont have "large" or "high" in them
+# 0.4
+#  If nothing is found based on IMDB title, try looking for movie's short title
+# 0.5
+#  If apple.com doesnt return anything, try googling it :)
+# 0.6
+#  Updated and added more recognition in getting the large trailer from a page with choices of small/med/large
+
+use LWP::Simple;      # libwww-perl providing simple HTML get actions
+use HTML::Entities;
+use URI::Escape;
+
+
+
+use vars qw($opt_r $opt_d $opt_T);
+use Getopt::Std; 
+
+
+# display usage
+sub usage {
+   print "usage: $0 \n";
+   print "       -T <movieid>  get movie trailer\n";
+   print "       -d enable debug";
+   exit(-1);
+}
+
+# returns text within 'data' between 'beg' and 'end' matching strings (taken from imdb.pl)
+sub parseBetween {
+   my ($data, $beg, $end)=@_; # grab parameters
+
+   my $ldata = lc($data);
+   my $start = index($ldata, lc($beg)) + length($beg);
+   my $finish = index($ldata, lc($end), $start);
+   if ($start != (length($beg) -1) && $finish != -1) {
+      my $result = substr($data, $start, $finish - $start);
+      # return w/ decoded numeric character references
+      # (see http://www.w3.org/TR/html4/charset.html#h-5.3.1)
+      decode_entities($result);
+      return $result;
+   }
+   return "";
+}
+
+sub getTrailerURL {
+   my ($movieid) = @_;
+   
+   # get the name of the movie
+   my $host = "http://www.imdb.com/title/tt" . $movieid . "/";
+   my $response = get $host;
+
+   # get the title
+   my $movie_title = parseBetween($response, "<title>", "<\/title>");
+
+   $response =~ /<br>([\w\s\(\)^<^>]+)\S+?\(short title\)/i;
+   my $short_movie_title = "";
+   $short_movie_title = $1 if ($1);
+
+
+   # get rid of the year
+   $movie_title =~ s/\ *\(.+?\)//xig;
+   $movie_title =~ s/\ *,\ *(The|A)$//xgi;
+   $movie_title =~ s/\&//ig;
+
+   # get rid of the year
+   $short_movie_title =~ s/\ *\(.+?\)//xig;
+   $short_movie_title =~ s/\ *,\ *(The|A)$//xgi;
+   $short_movie_title =~ s/\&//ig;
+   
+   if (defined $opt_d) { printf("# looking for movie id: $movieid title: $movie_title short title: $short_movie_title\n"); }
+   
+   # add pluses
+   my $movie_title_plus = $movie_title;
+   $movie_title_plus =~ tr/ /+/;
+   my $short_movie_title_plus = $short_movie_title;
+   $short_movie_title_plus =~ tr/ /+/;    
+   
+   my $found = 0;
+   my $search_string = $movie_title_plus;   
+   my $trailer_page_uri = "";    
+
+   while (!$found) {
+       if (defined $opt_d) { printf("# looking for: $search_string\n"); }
+       # do the search
+       $host = "http://searchcgi.apple.com/cgi-bin/sp/nph-searchpre1.pl?q=".$search_string."+site:www.apple.com/trailers&restrict=us_trailers_only&client=www_collection&site=www_collection&lr=lang_en&output=xml&sort=&filter=0&access=p";
+       $response = get $host;
+       
+           # find URL with "large"
+           if ($trailer_page_uri eq "") {
+                   if ($response =~ m/\"(http:\/\/.*large.*)\"/i) {
+                           $trailer_page_uri = $1;
+                           if (defined $opt_d) { printf("# found large\n"); }
+                   }
+           }
+   
+           # check for high
+           if ($trailer_page_uri eq "") {
+                   if ($response =~ m/\"(http:\/\/(.*high.*))\"/i) {
+                           $trailer_page_uri = $1; 
+                           if (defined $opt_d) { printf("# found high\n"); }
+                   } 
+           }
+   
+           # must not have "large" or "high"
+           if ($trailer_page_uri eq "") {
+                   if ($response =~ m/href=\"(http:\/\/[\w.\/]+)\">(Apple - Trailers)[^<]+/i) {
+                           $trailer_page_uri = $1;
+                           if (defined $opt_d) { printf("# found other\n"); }
+                   } 
+           }
+           
+           # check for "large" in the title
+           if ($trailer_page_uri eq "") {
+                   if ($response =~ m/<a.*?href=\"([^\"]*)\"[^>]*?>.*?large.*?<\/a>/i) {
+                           $trailer_page_uri = $1;
+                           if (defined $opt_d) { printf("# found title - large\n"); }
+                   }
+           }	
+   
+           # we must be at the studios page
+           if ($trailer_page_uri =~ m/\/$/) {
+                   if (defined $opt_d) { printf("# didnt find the movie, found studio: $trailer_page_uri\n"); }
+                   # look for a movie
+                   $response =~ /href=\"([^"]+)\"[^>]*>.*?<b>.*?<\/a>/i;
+                   $trailer_page_uri = $1;
+   
+                   # search for a partial match, if the movie is on the studios page, movie must be here
+                   if (defined($trailer_page_uri)) {
+                           if (defined $opt_d) { printf("# new trailer page: $trailer_page_uri\n"); }
+   
+                           # get the actual page
+                           $response = get $trailer_page_uri;
+                           if (
+                               $response =~ m/<a.*?href=\"([^\"]*)\"[^>]*?>.*?large/i || # large in image name after A
+                               $response =~ m/<a.*?href=\"([^\"]*)\"[^>]*?large[^>]*?>/i || # large within javascript
+                               $response =~ m/\"(.*large[^\"]*)\"/i || # large in actual filename
+                               $response =~ m/\"([^<>\"]*?high[^\"<>]*?)\"/i || # high in filename
+                               $response =~ m/<a.*?href=\"([^\"]*)\"[^>]*?>.*?high/i || # high  after A
+                               $response =~ m/\"([^\"]*?lrg[^\"]*?)\"/i ||  #lrg in filename
+                               $response =~ m/\"([^\"]*?_lg.[^\"]*?)\"/i || #_lg. in filename
+                               $response =~ m/\"([^\"]*?480[^\"]*?)\"/i # 480 in filename
+                               ) {
+									# m/\"([^\"]*?high[^\"]*?)\"/i - gangs of new york
+                                   if (defined $opt_d) { printf("# found large trailer\n"); }
+                                   $trailer_page_uri .= $1;
+                           } else {
+                              $trailer_page_uri = "";
+                           }
+                   } else {
+                           $trailer_page_uri = "";
+                   }
+           }
+           if ($trailer_page_uri eq "" and $short_movie_title ne "" and !$found and $search_string ne $short_movie_title_plus) {
+               $search_string = $short_movie_title_plus;
+               
+           } else {
+               $found = 1;
+           }
+   }
+
+    
+   # lets try googling (cant merge with above code yet)
+   if ($trailer_page_uri eq "") {
+      if (defined $opt_d) { printf("# googling for: $movie_title_plus\n"); }
+     
+      # google requires the following hack, otherwise it give 403 (try googling a seach page with wget)
+      require LWP::UserAgent;
+      
+      my $ua = LWP::UserAgent->new;
+      # gotta trick google     
+      $ua->agent('Mozilla/5.0');
+      
+      $response = $ua->get("http://www.google.com/search?hl=en&ie=UTF-8&q=$movie_title_plus+site:www.apple.com");
+      $response = $response->content;
+ 
+      # must not have "large" or "high"
+      if ($trailer_page_uri eq "") {
+              if ($response =~ m/href=(http:\/\/[\w.\/]+)[^>]*?>(Apple - Trailers)[^<]+/i) {
+                      $trailer_page_uri = $1;
+                      if (defined $opt_d) { printf("# googled other\n"); }
+              } 
+      }
+            
+   }
+    
+    
+    
+    my $trailer_uri = "";
+    #only proceed, if something was found
+    if ($trailer_page_uri ne "") {
+        if (defined $opt_d) { printf("# trailer page found: $trailer_page_uri\n"); }
+        
+	# get the trailer page
+	$response = get $trailer_page_uri;
+	$response = lc($response);
+
+	if (defined $opt_r) { printf($response); }
+        
+	# try parsing...
+	$trailer_uri = parseBetween($response,"name=\"href\" value=\"","\"") if ($trailer_uri eq "");
+	$trailer_uri = parseBetween($response,"controller=\"false\" href=\"","\"") if ($trailer_uri eq "");
+	$trailer_uri = parseBetween($response,"target=\"myself\" src=\"","\"") if ($trailer_uri eq "");
+	$trailer_uri = parseBetween($response,"controller=\"true\" src=\"","\"") if ($trailer_uri eq "");
+	$trailer_uri = parseBetween($response,"param name=\"src\" value=\"","\"") if ($trailer_uri eq "");	
+
+	# now we need to get the filename of the ACTUAL file
+	if ($trailer_uri ne "") {
+            if (defined $opt_d) { printf("# actual trailer found: $trailer_uri\n"); }
+            if (defined $opt_d) { printf("# starting to download\n"); }
+	
+	    my $file_size = 0; 	
+	    while ($file_size < 100000) {
+		    my @headers = head $trailer_uri;
+		    $file_size = $headers[1];
+	    	
+            	    if ($file_size < 100000) { # to be save
+			    my $file = get $trailer_uri;
+
+	    		    $file =~ /(.*\.mov.*)*url.{5}([\w-]+.mov).*$/is;
+		       	    $file = $2;
+       
+		            if (defined $opt_d) { printf("# actual filename is $file\n"); }
+        		    $trailer_uri =~ s/[^\/]+.mov$/$file/gi;
+		    }
+	    }
+            
+            if (defined $opt_d) { printf("# final trailer uri is $trailer_uri\n"); }
+        }
+    }
+	return $trailer_uri;
+}
+
+
+
+#
+# Main Program
+#
+
+# parse command line arguments 
+getopts('drT');
+
+# print out usage if needed
+if ($#ARGV<0) { usage(); }
+
+if (defined $opt_T) {
+   # take movieid from cmdline arg
+   $movieid = shift || die "Usage : $0 -T <movieid>\n";
+   my $trailer_uri = getTrailerURL($movieid);
+   #if (defined $opt_d) {
+      printf("$trailer_uri\n");
+   #}
+#   if ($trailer_uri ne "") {
+#	   system "wget -O $movieid.mov $trailer_uri"; 
+#   }   
+}
+
+
+
diff -Naur mythtv-0.18.1-old/libs/libavcodec/avcodec.h mythtv-0.18.1-new/libs/libavcodec/avcodec.h
--- mythtv-0.18.1-old/libs/libavcodec/avcodec.h	2005-01-31 21:09:30.000000000 -0800
+++ mythtv-0.18.1-new/libs/libavcodec/avcodec.h	2005-11-19 07:20:36.000000000 -0800
@@ -1760,40 +1760,7 @@
 } AVCodecContext;
 
 
-/**
- * AVOption.
- */
-typedef struct AVOption {
-    /** options' name */
-    const char *name; /* if name is NULL, it indicates a link to next */
-    /** short English text help or const struct AVOption* subpointer */
-    const char *help; //	const struct AVOption* sub;
-    /** offset to context structure where the parsed value should be stored */
-    int offset;
-    /** options' type */
-    int type;
-#define FF_OPT_TYPE_BOOL 1      ///< boolean - true,1,on  (or simply presence)
-#define FF_OPT_TYPE_DOUBLE 2    ///< double
-#define FF_OPT_TYPE_INT 3       ///< integer
-#define FF_OPT_TYPE_STRING 4    ///< string (finished with \0)
-#define FF_OPT_TYPE_MASK 0x1f	///< mask for types - upper bits are various flags
-//#define FF_OPT_TYPE_EXPERT 0x20 // flag for expert option
-#define FF_OPT_TYPE_FLAG (FF_OPT_TYPE_BOOL | 0x40)
-#define FF_OPT_TYPE_RCOVERRIDE (FF_OPT_TYPE_STRING | 0x80)
-    /** min value  (min == max   ->  no limits) */
-    double min;
-    /** maximum value for double/int */
-    double max;
-    /** default boo [0,1]l/double/int value */
-    double defval;
-    /**
-     * default string value (with optional semicolon delimited extra option-list
-     * i.e.   option1;option2;option3
-     * defval might select other then first argument as default
-     */
-    const char *defstr;
-#define FF_OPT_MAX_DEPTH 10
-} AVOption;
+struct AVOption;
 
 /**
  * Parse option(s) and sets fields in passed structure
diff -Naur mythtv-0.18.1-old/libs/libavcodec/common.h mythtv-0.18.1-new/libs/libavcodec/common.h
--- mythtv-0.18.1-old/libs/libavcodec/common.h	2005-01-07 22:32:42.000000000 -0800
+++ mythtv-0.18.1-new/libs/libavcodec/common.h	2005-11-19 07:20:36.000000000 -0800
@@ -16,6 +16,38 @@
 #define M_PI    3.14159265358979323846
 #endif
 
+typedef struct AVOption {
+    /** options' name */
+    const char *name; /* if name is NULL, it indicates a link to next */
+    /** short English text help or const struct AVOption* subpointer */
+    const char *help; //        const struct AVOption* sub;
+    /** offset to context structure where the parsed value should be stored */
+    int offset;
+    /** options' type */
+    int type;
+#define FF_OPT_TYPE_BOOL 1      ///< boolean - true,1,on  (or simply presence)
+#define FF_OPT_TYPE_DOUBLE 2    ///< double
+#define FF_OPT_TYPE_INT 3       ///< integer
+#define FF_OPT_TYPE_STRING 4    ///< string (finished with \0)
+#define FF_OPT_TYPE_MASK 0x1f   ///< mask for types - upper bits are various flags
+//#define FF_OPT_TYPE_EXPERT 0x20 // flag for expert option
+#define FF_OPT_TYPE_FLAG (FF_OPT_TYPE_BOOL | 0x40)
+#define FF_OPT_TYPE_RCOVERRIDE (FF_OPT_TYPE_STRING | 0x80)
+    /** min value  (min == max   ->  no limits) */
+    double min;
+    /** maximum value for double/int */
+    double max;
+    /** default boo [0,1]l/double/int value */
+    double defval;
+    /**
+     * default string value (with optional semicolon delimited extra option-list
+     * i.e.   option1;option2;option3
+     * defval might select other then first argument as default
+     */
+    const char *defstr;
+#define FF_OPT_MAX_DEPTH 10
+} AVOption;
+
 #ifdef HAVE_AV_CONFIG_H
 /* only include the following when compiling package */
 #    include "config.h"
@@ -56,7 +88,6 @@
 #define AVOPTION_SUB(ptr) { .name = NULL, .help = (const char*)ptr }
 #define AVOPTION_END() AVOPTION_SUB(NULL)
 
-struct AVOption;
 #ifdef HAVE_MMX
 extern const struct AVOption avoptions_common[3 + 5];
 #else
diff -Naur mythtv-0.18.1-old/libs/libavcodec/libpostproc/postprocess_template.c mythtv-0.18.1-new/libs/libavcodec/libpostproc/postprocess_template.c
--- mythtv-0.18.1-old/libs/libavcodec/libpostproc/postprocess_template.c	2004-11-17 21:59:37.000000000 -0800
+++ mythtv-0.18.1-new/libs/libavcodec/libpostproc/postprocess_template.c	2005-11-19 07:20:36.000000000 -0800
@@ -2898,6 +2898,8 @@
 
 		src+= step; // src points to begin of the 8x8 Block
 
+		dc_mask &= eq_mask;
+
 		asm volatile(
 		"movq %4, %%mm6					\n\t"
 		"pcmpeqb %%mm5, %%mm5				\n\t"
@@ -2930,7 +2932,7 @@
 		" js 1b						\n\t"
 
 		: "+r"(offset), "+r"(temp_sums)
-		: "r" ((long)step), "r"(src - offset), "m"(dc_mask & eq_mask)
+		: "r" ((long)step), "r"(src - offset), "m"(dc_mask)
 		);
 	}else
 		src+= step; // src points to begin of the 8x8 Block
diff -Naur mythtv-0.18.1-old/libs/libmyth/audiooutputca.cpp mythtv-0.18.1-new/libs/libmyth/audiooutputca.cpp
--- mythtv-0.18.1-old/libs/libmyth/audiooutputca.cpp	2004-11-10 23:36:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmyth/audiooutputca.cpp	2005-11-19 07:20:36.000000000 -0800
@@ -7,7 +7,7 @@
  * This plays MythTV audio through the default output device on OS X.
  *
  * = REVISION
- * $Id: audiooutputca.cpp,v 1.2 2004/11/11 07:36:44 ijr Exp $
+ * $Id: audiooutputca.cpp 4668 2004-11-11 07:36:45Z ijr $
  *
  * = AUTHORS
  * Jeremiah Morris
diff -Naur mythtv-0.18.1-old/libs/libmyth/mythcontext.cpp mythtv-0.18.1-new/libs/libmyth/mythcontext.cpp
--- mythtv-0.18.1-old/libs/libmyth/mythcontext.cpp	2005-04-11 11:59:29.000000000 -0700
+++ mythtv-0.18.1-new/libs/libmyth/mythcontext.cpp	2005-11-19 07:20:36.000000000 -0800
@@ -1974,7 +1974,15 @@
         WriteStringList(d->serverSock, strlist);
         ok = ReadStringList(d->serverSock, strlist, quickTimeout);
 
-        // this should be obsolete...
+        if (!ok)
+        {
+            VERBOSE(VB_IMPORTANT, QString("Connection to backend server lost"));
+            ConnectToMasterServer();
+            WriteStringList(d->serverSock, strlist);
+            ok = ReadStringList(d->serverSock, strlist, quickTimeout);
+        }
+
+        // this should not happen
         while (ok && strlist[0] == "BACKEND_MESSAGE")
         {
             // oops, not for us
@@ -1992,7 +2000,7 @@
         if (!ok)
         {
             qApp->lock();
-            VERBOSE(VB_ALL, QString("Connection to backend server lost"));
+            VERBOSE(VB_ALL, QString("Reconnection to backend server failed"));
             MythPopupBox::showOkPopup(d->mainWindow, "connection failure",
                              tr("The connection to the master backend "
                                 "server has gone away for some reason.. "
diff -Naur mythtv-0.18.1-old/libs/libmyth/mythcontext.h mythtv-0.18.1-new/libs/libmyth/mythcontext.h
--- mythtv-0.18.1-old/libs/libmyth/mythcontext.h	2005-05-10 13:10:17.000000000 -0700
+++ mythtv-0.18.1-new/libs/libmyth/mythcontext.h	2005-11-19 07:20:36.000000000 -0800
@@ -162,7 +162,7 @@
     void *m_data;
 };
 
-#define MYTH_BINARY_VERSION "0.18.1.20050510-1"
+#define MYTH_BINARY_VERSION "0.18.1.20050523-1"
 #define MYTH_PROTO_VERSION "15"
 
 extern int print_verbose_messages;
diff -Naur mythtv-0.18.1-old/libs/libmyth/mythwidgets.cpp mythtv-0.18.1-new/libs/libmyth/mythwidgets.cpp
--- mythtv-0.18.1-old/libs/libmyth/mythwidgets.cpp	2005-04-09 22:15:53.000000000 -0700
+++ mythtv-0.18.1-new/libs/libmyth/mythwidgets.cpp	2005-11-19 07:20:36.000000000 -0800
@@ -934,9 +934,13 @@
 {
     bool handled = false;
     QStringList actions;
+    keyPressActions.clear();
+
     if (gContext->GetMainWindow()->TranslateKeyPress("qt", (QKeyEvent *)e,
                                                      actions))
     {
+        keyPressActions = actions;
+
         for (unsigned int i = 0; i < actions.size() && !handled; i++)
         {
             QString action = actions[i];
@@ -970,10 +974,7 @@
 void MythPushButton::keyReleaseEvent(QKeyEvent *e)
 {
     bool handled = false;
-    QStringList actions;
-    if (gContext->GetMainWindow()->TranslateKeyPress("qt", (QKeyEvent *)e,
-                                                     actions))
-    {
+    QStringList actions = keyPressActions;
         for (unsigned int i = 0; i < actions.size() && !handled; i++)
         {
             QString action = actions[i];
@@ -984,7 +985,6 @@
                 handled = true;
             }
         }
-    }
 
     if (!handled)
         QPushButton::keyReleaseEvent(e);
diff -Naur mythtv-0.18.1-old/libs/libmyth/mythwidgets.h mythtv-0.18.1-new/libs/libmyth/mythwidgets.h
--- mythtv-0.18.1-old/libs/libmyth/mythwidgets.h	2005-04-09 22:15:53.000000000 -0700
+++ mythtv-0.18.1-new/libs/libmyth/mythwidgets.h	2005-11-19 07:20:36.000000000 -0800
@@ -260,6 +260,8 @@
     QColor origcolor;
     QString helptext;
     bool arrowAccel;
+
+    QStringList keyPressActions;
 };
 
 class MythCheckBox: public QCheckBox
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/AAFilter.cpp mythtv-0.18.1-new/libs/libmythsoundtouch/AAFilter.cpp
--- mythtv-0.18.1-old/libs/libmythsoundtouch/AAFilter.cpp	2004-11-13 14:29:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/AAFilter.cpp	2005-11-19 07:20:36.000000000 -0800
@@ -12,10 +12,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2004/11/13 22:29:44 $
-// File revision : $Revision: 1.1 $
+// Last changed  : $Date: 2004-11-13 14:29:45 -0800 (Sat, 13 Nov 2004) $
+// File revision : $Revision: 4714 $
 //
-// $Id: AAFilter.cpp,v 1.1 2004/11/13 22:29:44 ijr Exp $
+// $Id: AAFilter.cpp 4714 2004-11-13 22:29:45Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/AAFilter.h mythtv-0.18.1-new/libs/libmythsoundtouch/AAFilter.h
--- mythtv-0.18.1-old/libs/libmythsoundtouch/AAFilter.h	2004-11-13 14:29:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/AAFilter.h	2005-11-19 07:20:36.000000000 -0800
@@ -13,10 +13,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2004/11/13 22:29:44 $
-// File revision : $Revision: 1.1 $
+// Last changed  : $Date: 2004-11-13 14:29:45 -0800 (Sat, 13 Nov 2004) $
+// File revision : $Revision: 4714 $
 //
-// $Id: AAFilter.h,v 1.1 2004/11/13 22:29:44 ijr Exp $
+// $Id: AAFilter.h 4714 2004-11-13 22:29:45Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/BPMDetect.h mythtv-0.18.1-new/libs/libmythsoundtouch/BPMDetect.h
--- mythtv-0.18.1-old/libs/libmythsoundtouch/BPMDetect.h	2004-11-13 14:29:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/BPMDetect.h	2005-11-19 07:20:36.000000000 -0800
@@ -26,10 +26,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2004/11/13 22:29:44 $
-// File revision : $Revision: 1.1 $
+// Last changed  : $Date: 2004-11-13 14:29:45 -0800 (Sat, 13 Nov 2004) $
+// File revision : $Revision: 4714 $
 //
-// $Id: BPMDetect.h,v 1.1 2004/11/13 22:29:44 ijr Exp $
+// $Id: BPMDetect.h 4714 2004-11-13 22:29:45Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/cpu_detect.h mythtv-0.18.1-new/libs/libmythsoundtouch/cpu_detect.h
--- mythtv-0.18.1-old/libs/libmythsoundtouch/cpu_detect.h	2004-11-13 14:29:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/cpu_detect.h	2005-11-19 07:20:36.000000000 -0800
@@ -12,10 +12,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2004/11/13 22:29:44 $
-// File revision : $Revision: 1.1 $
+// Last changed  : $Date: 2004-11-13 14:29:45 -0800 (Sat, 13 Nov 2004) $
+// File revision : $Revision: 4714 $
 //
-// $Id: cpu_detect.h,v 1.1 2004/11/13 22:29:44 ijr Exp $
+// $Id: cpu_detect.h 4714 2004-11-13 22:29:45Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/cpu_detect_x86_gcc.cpp mythtv-0.18.1-new/libs/libmythsoundtouch/cpu_detect_x86_gcc.cpp
--- mythtv-0.18.1-old/libs/libmythsoundtouch/cpu_detect_x86_gcc.cpp	2005-01-23 22:42:19.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/cpu_detect_x86_gcc.cpp	2005-11-19 07:20:36.000000000 -0800
@@ -12,10 +12,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2005/01/24 06:42:19 $
-// File revision : $Revision: 1.2 $
+// Last changed  : $Date: 2005-01-23 22:42:19 -0800 (Sun, 23 Jan 2005) $
+// File revision : $Revision: 5151 $
 //
-// $Id: cpu_detect_x86_gcc.cpp,v 1.2 2005/01/24 06:42:19 ijr Exp $
+// $Id: cpu_detect_x86_gcc.cpp 5151 2005-01-24 06:42:19Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/FIFOSampleBuffer.cpp mythtv-0.18.1-new/libs/libmythsoundtouch/FIFOSampleBuffer.cpp
--- mythtv-0.18.1-old/libs/libmythsoundtouch/FIFOSampleBuffer.cpp	2004-11-13 14:29:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/FIFOSampleBuffer.cpp	2005-11-19 07:20:36.000000000 -0800
@@ -15,10 +15,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2004/11/13 22:29:44 $
-// File revision : $Revision: 1.1 $
+// Last changed  : $Date: 2004-11-13 14:29:45 -0800 (Sat, 13 Nov 2004) $
+// File revision : $Revision: 4714 $
 //
-// $Id: FIFOSampleBuffer.cpp,v 1.1 2004/11/13 22:29:44 ijr Exp $
+// $Id: FIFOSampleBuffer.cpp 4714 2004-11-13 22:29:45Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/FIFOSampleBuffer.h mythtv-0.18.1-new/libs/libmythsoundtouch/FIFOSampleBuffer.h
--- mythtv-0.18.1-old/libs/libmythsoundtouch/FIFOSampleBuffer.h	2004-11-13 14:29:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/FIFOSampleBuffer.h	2005-11-19 07:20:36.000000000 -0800
@@ -15,10 +15,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2004/11/13 22:29:44 $
-// File revision : $Revision: 1.1 $
+// Last changed  : $Date: 2004-11-13 14:29:45 -0800 (Sat, 13 Nov 2004) $
+// File revision : $Revision: 4714 $
 //
-// $Id: FIFOSampleBuffer.h,v 1.1 2004/11/13 22:29:44 ijr Exp $
+// $Id: FIFOSampleBuffer.h 4714 2004-11-13 22:29:45Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/FIFOSamplePipe.h mythtv-0.18.1-new/libs/libmythsoundtouch/FIFOSamplePipe.h
--- mythtv-0.18.1-old/libs/libmythsoundtouch/FIFOSamplePipe.h	2004-11-13 14:29:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/FIFOSamplePipe.h	2005-11-19 07:20:36.000000000 -0800
@@ -17,10 +17,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2004/11/13 22:29:44 $
-// File revision : $Revision: 1.1 $
+// Last changed  : $Date: 2004-11-13 14:29:45 -0800 (Sat, 13 Nov 2004) $
+// File revision : $Revision: 4714 $
 //
-// $Id: FIFOSamplePipe.h,v 1.1 2004/11/13 22:29:44 ijr Exp $
+// $Id: FIFOSamplePipe.h 4714 2004-11-13 22:29:45Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/FIRFilter.cpp mythtv-0.18.1-new/libs/libmythsoundtouch/FIRFilter.cpp
--- mythtv-0.18.1-old/libs/libmythsoundtouch/FIRFilter.cpp	2004-11-13 14:29:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/FIRFilter.cpp	2005-11-19 07:20:36.000000000 -0800
@@ -11,10 +11,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2004/11/13 22:29:44 $
-// File revision : $Revision: 1.1 $
+// Last changed  : $Date: 2004-11-13 14:29:45 -0800 (Sat, 13 Nov 2004) $
+// File revision : $Revision: 4714 $
 //
-// $Id: FIRFilter.cpp,v 1.1 2004/11/13 22:29:44 ijr Exp $
+// $Id: FIRFilter.cpp 4714 2004-11-13 22:29:45Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/FIRFilter.h mythtv-0.18.1-new/libs/libmythsoundtouch/FIRFilter.h
--- mythtv-0.18.1-old/libs/libmythsoundtouch/FIRFilter.h	2004-11-13 14:29:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/FIRFilter.h	2005-11-19 07:20:36.000000000 -0800
@@ -11,10 +11,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2004/11/13 22:29:44 $
-// File revision : $Revision: 1.1 $
+// Last changed  : $Date: 2004-11-13 14:29:45 -0800 (Sat, 13 Nov 2004) $
+// File revision : $Revision: 4714 $
 //
-// $Id: FIRFilter.h,v 1.1 2004/11/13 22:29:44 ijr Exp $
+// $Id: FIRFilter.h 4714 2004-11-13 22:29:45Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/mmx_gcc.cpp mythtv-0.18.1-new/libs/libmythsoundtouch/mmx_gcc.cpp
--- mythtv-0.18.1-old/libs/libmythsoundtouch/mmx_gcc.cpp	2005-01-30 22:14:20.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/mmx_gcc.cpp	2005-11-19 07:20:36.000000000 -0800
@@ -15,10 +15,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2005/01/31 06:14:20 $
-// File revision : $Revision: 1.5 $
+// Last changed  : $Date: 2005-11-15 00:21:12 -0800 (Tue, 15 Nov 2005) $
+// File revision : $Revision: 7881 $
 //
-// $Id: mmx_gcc.cpp,v 1.5 2005/01/31 06:14:20 ijr Exp $
+// $Id: mmx_gcc.cpp 7881 2005-11-15 08:21:12Z jarod $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
@@ -251,7 +251,7 @@
     // Ensure that filter coeffs array is aligned to 16-byte boundary
     delete[] filterCoeffsUnalign;
     filterCoeffsUnalign = new short[2 * newLength + 8];
-    filterCoeffsAlign = (short *)(((uint)filterCoeffsUnalign + 15) & -16);
+    filterCoeffsAlign = (short *)(((ulong)filterCoeffsUnalign + 15) & -16);
 
     // rearrange the filter coefficients for mmx routines 
     for (i = 0;i < length; i += 4) 
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/RateTransposer.cpp mythtv-0.18.1-new/libs/libmythsoundtouch/RateTransposer.cpp
--- mythtv-0.18.1-old/libs/libmythsoundtouch/RateTransposer.cpp	2004-11-13 14:29:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/RateTransposer.cpp	2005-11-19 07:20:36.000000000 -0800
@@ -10,10 +10,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2004/11/13 22:29:44 $
-// File revision : $Revision: 1.1 $
+// Last changed  : $Date: 2004-11-13 14:29:45 -0800 (Sat, 13 Nov 2004) $
+// File revision : $Revision: 4714 $
 //
-// $Id: RateTransposer.cpp,v 1.1 2004/11/13 22:29:44 ijr Exp $
+// $Id: RateTransposer.cpp 4714 2004-11-13 22:29:45Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/RateTransposer.h mythtv-0.18.1-new/libs/libmythsoundtouch/RateTransposer.h
--- mythtv-0.18.1-old/libs/libmythsoundtouch/RateTransposer.h	2004-11-13 14:29:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/RateTransposer.h	2005-11-19 07:20:36.000000000 -0800
@@ -14,10 +14,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2004/11/13 22:29:44 $
-// File revision : $Revision: 1.1 $
+// Last changed  : $Date: 2004-11-13 14:29:45 -0800 (Sat, 13 Nov 2004) $
+// File revision : $Revision: 4714 $
 //
-// $Id: RateTransposer.h,v 1.1 2004/11/13 22:29:44 ijr Exp $
+// $Id: RateTransposer.h 4714 2004-11-13 22:29:45Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/SoundTouch.cpp mythtv-0.18.1-new/libs/libmythsoundtouch/SoundTouch.cpp
--- mythtv-0.18.1-old/libs/libmythsoundtouch/SoundTouch.cpp	2004-11-13 14:29:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/SoundTouch.cpp	2005-11-19 07:20:36.000000000 -0800
@@ -41,10 +41,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2004/11/13 22:29:44 $
-// File revision : $Revision: 1.1 $
+// Last changed  : $Date: 2004-11-13 14:29:45 -0800 (Sat, 13 Nov 2004) $
+// File revision : $Revision: 4714 $
 //
-// $Id: SoundTouch.cpp,v 1.1 2004/11/13 22:29:44 ijr Exp $
+// $Id: SoundTouch.cpp 4714 2004-11-13 22:29:45Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/SoundTouch.h mythtv-0.18.1-new/libs/libmythsoundtouch/SoundTouch.h
--- mythtv-0.18.1-old/libs/libmythsoundtouch/SoundTouch.h	2004-11-13 14:29:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/SoundTouch.h	2005-11-19 07:20:36.000000000 -0800
@@ -41,10 +41,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2004/11/13 22:29:44 $
-// File revision : $Revision: 1.1 $
+// Last changed  : $Date: 2004-11-13 14:29:45 -0800 (Sat, 13 Nov 2004) $
+// File revision : $Revision: 4714 $
 //
-// $Id: SoundTouch.h,v 1.1 2004/11/13 22:29:44 ijr Exp $
+// $Id: SoundTouch.h 4714 2004-11-13 22:29:45Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/STTypes.h mythtv-0.18.1-new/libs/libmythsoundtouch/STTypes.h
--- mythtv-0.18.1-old/libs/libmythsoundtouch/STTypes.h	2005-01-20 22:08:36.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/STTypes.h	2005-11-19 07:20:36.000000000 -0800
@@ -8,10 +8,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2005/01/21 06:08:36 $
-// File revision : $Revision: 1.2 $
+// Last changed  : $Date: 2005-01-20 22:08:36 -0800 (Thu, 20 Jan 2005) $
+// File revision : $Revision: 5097 $
 //
-// $Id: STTypes.h,v 1.2 2005/01/21 06:08:36 ijr Exp $
+// $Id: STTypes.h 5097 2005-01-21 06:08:36Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/TDStretch.cpp mythtv-0.18.1-new/libs/libmythsoundtouch/TDStretch.cpp
--- mythtv-0.18.1-old/libs/libmythsoundtouch/TDStretch.cpp	2004-11-13 14:29:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/TDStretch.cpp	2005-11-19 07:20:36.000000000 -0800
@@ -13,10 +13,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2004/11/13 22:29:44 $
-// File revision : $Revision: 1.1 $
+// Last changed  : $Date: 2004-11-13 14:29:45 -0800 (Sat, 13 Nov 2004) $
+// File revision : $Revision: 4714 $
 //
-// $Id: TDStretch.cpp,v 1.1 2004/11/13 22:29:44 ijr Exp $
+// $Id: TDStretch.cpp 4714 2004-11-13 22:29:45Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythsoundtouch/TDStretch.h mythtv-0.18.1-new/libs/libmythsoundtouch/TDStretch.h
--- mythtv-0.18.1-old/libs/libmythsoundtouch/TDStretch.h	2004-11-13 14:29:44.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythsoundtouch/TDStretch.h	2005-11-19 07:20:36.000000000 -0800
@@ -13,10 +13,10 @@
 ///
 ////////////////////////////////////////////////////////////////////////////////
 //
-// Last changed  : $Date: 2004/11/13 22:29:44 $
-// File revision : $Revision: 1.1 $
+// Last changed  : $Date: 2004-11-13 14:29:45 -0800 (Sat, 13 Nov 2004) $
+// File revision : $Revision: 4714 $
 //
-// $Id: TDStretch.h,v 1.1 2004/11/13 22:29:44 ijr Exp $
+// $Id: TDStretch.h 4714 2004-11-13 22:29:45Z ijr $
 //
 ////////////////////////////////////////////////////////////////////////////////
 //
diff -Naur mythtv-0.18.1-old/libs/libmythtv/avformatdecoder.cpp mythtv-0.18.1-new/libs/libmythtv/avformatdecoder.cpp
--- mythtv-0.18.1-old/libs/libmythtv/avformatdecoder.cpp	2005-05-10 01:42:33.000000000 -0700
+++ mythtv-0.18.1-new/libs/libmythtv/avformatdecoder.cpp	2005-11-19 07:20:36.000000000 -0800
@@ -1254,7 +1254,7 @@
     
     while ((selectedTrack == -1) && (minChannels >= 0))
     {
-        for (track = maxTracks; track >= 0; track--)
+        for (track = 0; track <= maxTracks; track++)
         {
             int tempStream = audioStreams[track];
             AVCodecContext *e = &ic->streams[tempStream]->codec;
@@ -1279,13 +1279,13 @@
                 }
             }
         }
-        if (selectedTrack == -1)
+        if (selectedTrack > maxTracks)
         {
             minChannels--;
         }
     }
 
-    if (selectedTrack == -1)
+    if (selectedTrack > maxTracks)
     {
         VERBOSE(VB_AUDIO,
                 QString("No suitable audio track exists."));
diff -Naur mythtv-0.18.1-old/libs/libmythtv/dvbsignalmonitor.h mythtv-0.18.1-new/libs/libmythtv/dvbsignalmonitor.h
--- mythtv-0.18.1-old/libs/libmythtv/dvbsignalmonitor.h	2005-03-22 22:45:36.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythtv/dvbsignalmonitor.h	2005-11-19 07:20:37.000000000 -0800
@@ -1,54 +1,54 @@
-#ifndef DVBSIGNALMONITOR_H
-#define DVBSIGNALMONITOR_H
-
-#include <pthread.h>
-#include <qobject.h>
-
-#include "dvbtypes.h"
-
-class DVBSignalMonitor: public QObject
-{
-    Q_OBJECT
-
-public:
-    DVBSignalMonitor(int cardnum, int fd_frontend);
-    ~DVBSignalMonitor();
-    
-    void Start();
-    void Stop();
-
-signals:
-    void Status(dvb_stats_t &stats);
-    void Status(const QString &val);
-
-    void StatusSignalToNoise(int);
-    void StatusSignalStrength(int);
-    void StatusBitErrorRate(int);
-    void StatusUncorrectedBlocks(int);
-
-private:
-    void MonitorLoop();
-    static void* SpawnMonitorLoop(void*);
-    bool FillFrontendStats(dvb_stats_t &stats);
-
-    //int GetIDForCardNumber(int cardnum);
-    //void* QualityMonitorThread();
-    //void QualityMonitorSample(int cardnum, dvb_stats_t& sample);
-    //void ExpireQualityData();
-
-    static const QString TIMEOUT;
-    static const QString LOCKED;
-    static const QString NOTLOCKED;
-
-    //int     signal_monitor_interval;
-    //int     expire_data_days;
-
-
-    pthread_t   monitor_thread;
-    int         cardnum;
-    int         fd_frontend;
-    bool        running;
-    bool        exit;
-};
-
-#endif // DVBSIGNALMONITOR_H
+#ifndef DVBSIGNALMONITOR_H
+#define DVBSIGNALMONITOR_H
+
+#include <pthread.h>
+#include <qobject.h>
+
+#include "dvbtypes.h"
+
+class DVBSignalMonitor: public QObject
+{
+    Q_OBJECT
+
+public:
+    DVBSignalMonitor(int cardnum, int fd_frontend);
+    ~DVBSignalMonitor();
+    
+    void Start();
+    void Stop();
+
+signals:
+    void Status(dvb_stats_t &stats);
+    void Status(const QString &val);
+
+    void StatusSignalToNoise(int);
+    void StatusSignalStrength(int);
+    void StatusBitErrorRate(int);
+    void StatusUncorrectedBlocks(int);
+
+private:
+    void MonitorLoop();
+    static void* SpawnMonitorLoop(void*);
+    bool FillFrontendStats(dvb_stats_t &stats);
+
+    //int GetIDForCardNumber(int cardnum);
+    //void* QualityMonitorThread();
+    //void QualityMonitorSample(int cardnum, dvb_stats_t& sample);
+    //void ExpireQualityData();
+
+    static const QString TIMEOUT;
+    static const QString LOCKED;
+    static const QString NOTLOCKED;
+
+    //int     signal_monitor_interval;
+    //int     expire_data_days;
+
+
+    pthread_t   monitor_thread;
+    int         cardnum;
+    int         fd_frontend;
+    bool        running;
+    bool        exit;
+};
+
+#endif // DVBSIGNALMONITOR_H
diff -Naur mythtv-0.18.1-old/libs/libmythtv/dvbsiparser.cpp mythtv-0.18.1-new/libs/libmythtv/dvbsiparser.cpp
--- mythtv-0.18.1-old/libs/libmythtv/dvbsiparser.cpp	2005-01-30 21:49:56.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythtv/dvbsiparser.cpp	2005-11-19 07:20:37.000000000 -0800
@@ -1,5 +1,5 @@
 /*
- * $Id: dvbsiparser.cpp,v 1.2 2005/01/31 05:49:56 ijr Exp $
+ * $Id: dvbsiparser.cpp 5260 2005-01-31 05:49:56Z ijr $
  * vim: set expandtab tabstop=4 shiftwidth=4: 
  *
  * DVBSIParser.cpp: Digital Video Broadcast - Section/Table Parser
diff -Naur mythtv-0.18.1-old/libs/libmythtv/dvbtransporteditor.cpp mythtv-0.18.1-new/libs/libmythtv/dvbtransporteditor.cpp
--- mythtv-0.18.1-old/libs/libmythtv/dvbtransporteditor.cpp	2005-02-23 11:39:19.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythtv/dvbtransporteditor.cpp	2005-11-19 07:20:37.000000000 -0800
@@ -1,5 +1,5 @@
 /*
- * $Id: dvbtransporteditor.cpp,v 1.5 2005/02/23 19:39:19 cpinkham Exp $
+ * $Id: dvbtransporteditor.cpp 5685 2005-02-23 19:39:19Z cpinkham $
  * vim: set expandtab tabstop=4 shiftwidth=4:
  *
  * Original Project
diff -Naur mythtv-0.18.1-old/libs/libmythtv/dvbtransporteditor.h mythtv-0.18.1-new/libs/libmythtv/dvbtransporteditor.h
--- mythtv-0.18.1-old/libs/libmythtv/dvbtransporteditor.h	2005-02-22 21:04:36.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythtv/dvbtransporteditor.h	2005-11-19 07:20:37.000000000 -0800
@@ -1,5 +1,5 @@
 /*
- * $Id: dvbtransporteditor.h,v 1.3 2005/02/23 05:04:36 avalanche Exp $
+ * $Id: dvbtransporteditor.h 5683 2005-02-23 05:04:37Z avalanche $
  * vim: set expandtab tabstop=4 shiftwidth=4:
  *
  * Original Project
diff -Naur mythtv-0.18.1-old/libs/libmythtv/jobqueue.cpp mythtv-0.18.1-new/libs/libmythtv/jobqueue.cpp
--- mythtv-0.18.1-old/libs/libmythtv/jobqueue.cpp	2005-04-09 22:33:06.000000000 -0700
+++ mythtv-0.18.1-new/libs/libmythtv/jobqueue.cpp	2005-11-19 07:20:37.000000000 -0800
@@ -422,6 +422,10 @@
                     continue;
                 }
 
+                // never start or claim more than one job in a single run
+                if (startedJobAlready)
+                    continue;
+
                 if ((inTimeWindow) &&
                     (hostname == "") &&
                     (!ClaimJob(id)))
@@ -445,10 +449,6 @@
                     continue;
                 }
 
-                // never start more than one job at a time
-                if (startedJobAlready)
-                    continue;
-
                 message = QString("JobQueue: Processing '%1' job for chanid "
                                   "%2 @ %3, current status is '%4'")
                                   .arg(JobText(type))
diff -Naur mythtv-0.18.1-old/libs/libmythtv/libmythtv.pro mythtv-0.18.1-new/libs/libmythtv/libmythtv.pro
--- mythtv-0.18.1-old/libs/libmythtv/libmythtv.pro	2005-05-06 13:19:54.000000000 -0700
+++ mythtv-0.18.1-new/libs/libmythtv/libmythtv.pro	2005-11-19 07:20:37.000000000 -0800
@@ -148,5 +148,6 @@
 
 using_opengl_vsync {
     CONFIG += opengl
+    DEFINES += USING_OPENGL_VSYNC
 }
 
diff -Naur mythtv-0.18.1-old/libs/libmythtv/mpeg/mpegstreamdata.h mythtv-0.18.1-new/libs/libmythtv/mpeg/mpegstreamdata.h
--- mythtv-0.18.1-old/libs/libmythtv/mpeg/mpegstreamdata.h	2005-01-20 22:55:16.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythtv/mpeg/mpegstreamdata.h	2005-11-19 07:20:37.000000000 -0800
@@ -11,6 +11,7 @@
 class HDTVRecorder;
 class PSIPTable;
 class RingBuffer;
+class PESPacket;
 
 class MPEGStreamData {
   public:
diff -Naur mythtv-0.18.1-old/libs/libmythtv/mpeg/tspacket.cpp mythtv-0.18.1-new/libs/libmythtv/mpeg/tspacket.cpp
--- mythtv-0.18.1-old/libs/libmythtv/mpeg/tspacket.cpp	2004-12-07 18:04:08.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythtv/mpeg/tspacket.cpp	2005-11-19 07:20:37.000000000 -0800
@@ -14,7 +14,7 @@
 
 QString TSPacket::toString() const {
     QString str;
-    str.append("TSPacket @0x%1  ").arg(int(&data()[0]),0,16);
+    str.append("TSPacket @0x%1  ").arg(long(&data()[0]),0,16);
     str.append("raw: 0x%1 0x%2 0x%3 0x%4\n").arg(int(data()[0]),0,16).
         arg(int(data()[1]),0,16).arg(int(data()[2]),0,16).arg(int(data()[3]),0,16);
     str.append("                 inSync: %1\n").arg( HasSync());
diff -Naur mythtv-0.18.1-old/libs/libmythtv/programinfo.cpp mythtv-0.18.1-new/libs/libmythtv/programinfo.cpp
--- mythtv-0.18.1-old/libs/libmythtv/programinfo.cpp	2005-04-09 22:28:53.000000000 -0700
+++ mythtv-0.18.1-new/libs/libmythtv/programinfo.cpp	2005-11-19 07:20:37.000000000 -0800
@@ -2521,7 +2521,7 @@
                   "editing, bookmark FROM recorded WHERE "
                   "chanid = :CHANID AND starttime = :STARTTIME ;");
     query.bindValue(":CHANID", chanid);
-    query.bindValue(":STARTTIME", recstartts.toString("yyyyMMddhhmm"));
+    query.bindValue(":STARTTIME", recstartts.toString("yyyyMMddhhmm00"));
 
     if (query.exec() && query.isActive() && query.size() > 0)
     {
diff -Naur mythtv-0.18.1-old/libs/libmythtv/scanwizard.cpp mythtv-0.18.1-new/libs/libmythtv/scanwizard.cpp
--- mythtv-0.18.1-old/libs/libmythtv/scanwizard.cpp	2005-03-29 03:50:41.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythtv/scanwizard.cpp	2005-11-19 07:20:37.000000000 -0800
@@ -1,5 +1,5 @@
 /*
- * $Id: scanwizard.cpp,v 1.9 2005/03/29 11:50:41 oscar Exp $
+ * $Id: scanwizard.cpp 5876 2005-03-29 11:50:46Z oscar $
  * vim: set expandtab tabstop=4 shiftwidth=4:
  *
  * Original Project
diff -Naur mythtv-0.18.1-old/libs/libmythtv/scanwizard.h mythtv-0.18.1-new/libs/libmythtv/scanwizard.h
--- mythtv-0.18.1-old/libs/libmythtv/scanwizard.h	2005-03-26 07:16:49.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythtv/scanwizard.h	2005-11-19 07:20:37.000000000 -0800
@@ -1,5 +1,5 @@
 /*
- * $Id: scanwizard.h,v 1.5 2005/03/26 15:16:49 taylor Exp $
+ * $Id: scanwizard.h 7227 2005-09-11 09:35:19Z jarod $
  * vim: set expandtab tabstop=4 shiftwidth=4:
  *
  * Original Project
@@ -44,7 +44,15 @@
 class ATSCPane;
 class QAMPane;
 class SIScan;
+class ChannelBase;
+class Channel;
 class DVBChannel;
+class ScanWizard;
+class ScanWizardScanner;
+class ScanOptionalConfig;
+class ScanCountry;
+class SignalMonitorValue;
+class AnalogScan;
 
 class VideoSourceSetting: public ComboBoxSetting
 {
diff -Naur mythtv-0.18.1-old/libs/libmythtv/sitypes.cpp mythtv-0.18.1-new/libs/libmythtv/sitypes.cpp
--- mythtv-0.18.1-old/libs/libmythtv/sitypes.cpp	2005-03-27 10:18:56.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythtv/sitypes.cpp	2005-11-19 07:20:37.000000000 -0800
@@ -1,5 +1,5 @@
 /*
- * $Id: sitypes.cpp,v 1.8 2005/03/27 18:18:56 taylor Exp $
+ * $Id: sitypes.cpp 5859 2005-03-27 18:18:56Z taylor $
  * vim: set expandtab tabstop=4 shiftwidth=4:
  *
  * Original Project
diff -Naur mythtv-0.18.1-old/libs/libmythtv/sitypes.h mythtv-0.18.1-new/libs/libmythtv/sitypes.h
--- mythtv-0.18.1-old/libs/libmythtv/sitypes.h	2005-03-27 10:18:56.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythtv/sitypes.h	2005-11-19 07:20:37.000000000 -0800
@@ -1,5 +1,5 @@
 /*
- * $Id: sitypes.h,v 1.5 2005/03/27 18:18:56 taylor Exp $
+ * $Id: sitypes.h 5859 2005-03-27 18:18:56Z taylor $
  * vim: set expandtab tabstop=4 shiftwidth=4:
  */
 
diff -Naur mythtv-0.18.1-old/libs/libmythtv/videoout_ivtv.cpp mythtv-0.18.1-new/libs/libmythtv/videoout_ivtv.cpp
--- mythtv-0.18.1-old/libs/libmythtv/videoout_ivtv.cpp	2005-03-22 22:43:24.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythtv/videoout_ivtv.cpp	2005-11-19 07:20:37.000000000 -0800
@@ -50,6 +50,7 @@
     last_normal = true;
     last_mask = 2;
     osdbuffer = NULL;
+    alphaState = kAlpha_Solid;
 }
 
 VideoOutputIvtv::~VideoOutputIvtv()
@@ -58,26 +59,8 @@
 
     if (fbfd > 0)
     {
-        struct ivtvfb_ioctl_state_info fbstate;
-        memset(&fbstate, 0, sizeof(fbstate));
-
-        if (ioctl(fbfd, IVTVFB_IOCTL_GET_STATE, &fbstate) < 0)
-        {
-            perror("IVTVFB_IOCTL_GET_STATE");
-            return;
-        }
-
-        fbstate.status |= IVTVFB_STATUS_GLOBAL_ALPHA;
-        fbstate.status &= ~IVTVFB_STATUS_LOCAL_ALPHA;
-        fbstate.alpha = 255;
-
-        if (ioctl(fbfd, IVTVFB_IOCTL_SET_STATE, &fbstate) < 0)
-        {
-            perror("IVTVFB_IOCTL_SET_STATE");
-            return;
-        }
-
         ClearOSD();       
+        SetAlpha(kAlpha_Solid);
  
         close(fbfd);
     }
@@ -90,41 +73,57 @@
 {
     if (fbfd > 0) 
     {
-        if (driver_version >= 0x00000200)
-        {
-            struct ivtvfb_ioctl_blt_fill_args args;
-            args.rasterop = 0xa;
-            args.alpha_mode = 0x1;
-            args.alpha_mask = 0x0;
-            args.width = XJ_width;
-            args.height = XJ_height;
-            args.x = args.y = 0;
-            args.destPixelMask = 0xffffffff;
-            args.colour = 0;
-            if (ioctl(fbfd, IVTVFB_IOCTL_BLT_FILL, &args) < 0) 
-                perror("IVTVFB_IOCTL_BLT_FILL");
-        }
-        else
-        {
-            struct ivtv_osd_coords osdcoords;
-            memset(&osdcoords, 0, sizeof(osdcoords));
+        struct ivtv_osd_coords osdcoords;
+        memset(&osdcoords, 0, sizeof(osdcoords));
 
-            if (ioctl(fbfd, IVTVFB_IOCTL_GET_ACTIVE_BUFFER, &osdcoords) < 0)
-                perror("IVTVFB_IOCTL_GET_ACTIVE_BUFFER");
-            struct ivtvfb_ioctl_dma_host_to_ivtv_args prep;
-            memset(&prep, 0, sizeof(prep));
+        if (ioctl(fbfd, IVTVFB_IOCTL_GET_ACTIVE_BUFFER, &osdcoords) < 0)
+            perror("IVTVFB_IOCTL_GET_ACTIVE_BUFFER");
+        struct ivtvfb_ioctl_dma_host_to_ivtv_args prep;
+        memset(&prep, 0, sizeof(prep));
+
+        prep.source = osdbuf_aligned;
+        prep.dest_offset = 0;
+        prep.count = osdcoords.max_offset;
 
-            prep.source = osdbuf_aligned;
-            prep.dest_offset = 0;
-            prep.count = osdcoords.max_offset;
+        memset(osdbuf_aligned, 0x00, osdbufsize);
 
-            memset(osdbuf_aligned, 0x00, osdbufsize);
+        if (ioctl(fbfd, IVTVFB_IOCTL_PREP_FRAME, &prep) < 0)
+            perror("IVTVFB_IOCTL_PREP_FRAME");
+    }
+}
 
-            if (ioctl(fbfd, IVTVFB_IOCTL_PREP_FRAME, &prep) < 0)
-                perror("IVTVFB_IOCTL_PREP_FRAME");
-        }
-        lastcleared = true;
+void VideoOutputIvtv::SetAlpha(eAlphaState newAlphaState)
+{
+    if (alphaState == newAlphaState)
+        return;
+
+    alphaState = newAlphaState;
+
+    struct ivtvfb_ioctl_state_info fbstate;
+    memset(&fbstate, 0, sizeof(fbstate));
+    if (ioctl(fbfd, IVTVFB_IOCTL_GET_STATE, &fbstate) < 0)
+        perror("IVTVFB_IOCTL_GET_STATE");
+
+    if (alphaState == kAlpha_Local)
+    {
+        fbstate.status &= ~IVTVFB_STATUS_GLOBAL_ALPHA;
+        fbstate.status |= IVTVFB_STATUS_LOCAL_ALPHA;
+    }
+    else
+    {
+        fbstate.status |= IVTVFB_STATUS_GLOBAL_ALPHA;
+        fbstate.status &= ~IVTVFB_STATUS_LOCAL_ALPHA;
     }
+
+    if (alphaState == kAlpha_Solid)
+        fbstate.alpha = 255;
+    else if (alphaState == kAlpha_Clear)
+        fbstate.alpha = 0;
+    else if (alphaState == kAlpha_Embedded)
+        fbstate.alpha = gContext->GetNumSetting("PVR350EPGAlphaValue", 164);
+
+    if (ioctl(fbfd, IVTVFB_IOCTL_SET_STATE, &fbstate) < 0)
+        perror("IVTVFB_IOCTL_SET_STATE");
 }
 
 void VideoOutputIvtv::InputChanged(int width, int height, float aspect)
@@ -185,25 +184,6 @@
             return false;
         }
 
-        struct ivtvfb_ioctl_state_info fbstate;
-        memset(&fbstate, 0, sizeof(fbstate));
-
-        if (ioctl(fbfd, IVTVFB_IOCTL_GET_STATE, &fbstate) < 0)
-        {
-            perror("IVTVFB_IOCTL_GET_STATE");
-            return false;
-        }
-
-        fbstate.status &= ~IVTVFB_STATUS_GLOBAL_ALPHA;
-        fbstate.status |= IVTVFB_STATUS_LOCAL_ALPHA;
-        fbstate.alpha = 0;
-
-        if (ioctl(fbfd, IVTVFB_IOCTL_SET_STATE, &fbstate) < 0)
-        {
-            perror("IVTVFB_IOCTL_SET_STATE");
-            return false;
-        }
-
         struct ivtvfb_ioctl_get_frame_buffer igfb;
         memset(&igfb, 0, sizeof(igfb));
 
@@ -222,8 +202,6 @@
 
         ClearOSD();
 
-        usleep(20000);
-
         struct ivtv_osd_coords osdcoords;
         memset(&osdcoords, 0, sizeof(osdcoords));
         osdcoords.lines = XJ_height;
@@ -269,50 +247,6 @@
         driver_version = vcap.version;
 }
 
-void VideoOutputIvtv::EmbedInWidget(WId wid, int x, int y, int w, int h)
-{
-    if (embedding)
-        return;
-
-    struct ivtvfb_ioctl_state_info fbstate;
-    memset(&fbstate, 0, sizeof(fbstate));
-
-    if (ioctl(fbfd, IVTVFB_IOCTL_GET_STATE, &fbstate) < 0)
-        perror("IVTVFB_IOCTL_GET_STATE");
-
-    fbstate.status |= IVTVFB_STATUS_GLOBAL_ALPHA;
-    fbstate.status &= ~IVTVFB_STATUS_LOCAL_ALPHA;
-
-    int usealpha = gContext->GetNumSetting("PVR350EPGAlphaValue", 164);
-    fbstate.alpha = usealpha;
-
-    if (ioctl(fbfd, IVTVFB_IOCTL_SET_STATE, &fbstate) < 0)
-        perror("IVTVFB_IOCTL_SET_STATE");
-
-    VideoOutput::EmbedInWidget(wid, x, y, w, h);
-}
-
-void VideoOutputIvtv::StopEmbedding(void)
-{
-    if (!embedding)
-        return;
-
-    struct ivtvfb_ioctl_state_info fbstate;
-    memset(&fbstate, 0, sizeof(fbstate));
-
-    if (ioctl(fbfd, IVTVFB_IOCTL_GET_STATE, &fbstate) < 0)
-        perror("IVTVFB_IOCTL_GET_STATE");
-
-    fbstate.status &= ~IVTVFB_STATUS_GLOBAL_ALPHA;
-    fbstate.status |= IVTVFB_STATUS_LOCAL_ALPHA;
-    fbstate.alpha = 0;
-
-    if (ioctl(fbfd, IVTVFB_IOCTL_SET_STATE, &fbstate) < 0)
-        perror("IVTVFB_IOCTL_SET_STATE");
-
-    VideoOutput::StopEmbedding();
-}
-
 void VideoOutputIvtv::PrepareFrame(VideoFrame *buffer, FrameScanType t)
 {
     (void)buffer;
@@ -426,6 +360,11 @@
     {
         bool drawanyway = false;
 
+        if (embedding && alphaState != kAlpha_Embedded)
+            SetAlpha(kAlpha_Embedded);
+        else if (!embedding && alphaState == kAlpha_Embedded && lastcleared)
+            SetAlpha(kAlpha_Clear);
+
         VideoFrame tmpframe;
         tmpframe.codec = FMT_ARGB32;
         tmpframe.buf = (unsigned char *)osdbuf_aligned;
@@ -453,10 +392,15 @@
 
         if (lastcleared && drawanyway)
         {
-            ClearOSD();
+            if (!embedding)
+                SetAlpha(kAlpha_Clear);
+            lastcleared = true;
         } 
         else if (ret > 0 || drawanyway)
         {
+            if (embedding)
+                return;
+
             struct ivtvfb_ioctl_dma_host_to_ivtv_args prep;
             memset(&prep, 0, sizeof(prep));
 
@@ -466,6 +410,8 @@
 
             if (ioctl(fbfd, IVTVFB_IOCTL_PREP_FRAME, &prep) < 0)
                 perror("IVTVFB_IOCTL_PREP_FRAME");
+            if (alphaState != kAlpha_Local)
+                SetAlpha(kAlpha_Local);
         }
     }
 }
diff -Naur mythtv-0.18.1-old/libs/libmythtv/videoout_ivtv.h mythtv-0.18.1-new/libs/libmythtv/videoout_ivtv.h
--- mythtv-0.18.1-old/libs/libmythtv/videoout_ivtv.h	2005-02-03 17:38:46.000000000 -0800
+++ mythtv-0.18.1-new/libs/libmythtv/videoout_ivtv.h	2005-11-19 07:20:37.000000000 -0800
@@ -21,9 +21,6 @@
 
     void InputChanged(int width, int height, float aspect);
 
-    void EmbedInWidget(WId wid, int x, int y, int w, int h);
-    void StopEmbedding(void);
-
     int GetRefreshRate(void);
 
     void DrawUnusedRects(bool sync = true);
@@ -55,7 +52,10 @@
     int GetFramesPlayed(void);
 
   private:
+    typedef enum { kAlpha_Solid, kAlpha_Local, kAlpha_Clear, kAlpha_Embedded } eAlphaState;
+
     void ShowPip(VideoFrame *frame, NuppelVideoPlayer *pipplayer);
+    void SetAlpha(eAlphaState newAlpha);
  
     int videofd;
     int fbfd;
@@ -83,6 +83,7 @@
     float last_speed;
     bool last_normal;
     int last_mask;
+    eAlphaState alphaState;
 };
 
 #endif
diff -Naur mythtv-0.18.1-old/libs/libmythtv/videoout_quartz.cpp mythtv-0.18.1-new/libs/libmythtv/videoout_quartz.cpp
--- mythtv-0.18.1-old/libs/libmythtv/videoout_quartz.cpp	2005-04-07 08:33:50.000000000 -0700
+++ mythtv-0.18.1-new/libs/libmythtv/videoout_quartz.cpp	2005-11-19 07:20:37.000000000 -0800
@@ -17,7 +17,7 @@
  *   a second time, may cause a crash (backtraces appreciated)
  * 
  * = REVISION
- * $Id: videoout_quartz.cpp,v 1.11 2005/04/07 15:33:50 danielk Exp $
+ * $Id: videoout_quartz.cpp 5947 2005-04-07 15:33:50Z danielk $
  *
  * = AUTHORS
  * Nigel Pearson, Jeremiah Morris
diff -Naur mythtv-0.18.1-old/libs/libmythtv/vsync.cpp mythtv-0.18.1-new/libs/libmythtv/vsync.cpp
--- mythtv-0.18.1-old/libs/libmythtv/vsync.cpp	2005-04-12 15:08:44.000000000 -0700
+++ mythtv-0.18.1-new/libs/libmythtv/vsync.cpp	2005-11-19 07:20:37.000000000 -0800
@@ -83,7 +83,10 @@
     TESTVIDEOSYNC(nVidiaVideoSync)
     TESTVIDEOSYNC(DRMVideoSync)
 #ifdef USING_OPENGL_VSYNC
-    TESTVIDEOSYNC(OpenGLVideoSync)
+    if ((gContext->GetNumSetting("UseOpenGLVSync", 1)) && (getenv("NO_OPENGL_VSYNC") == NULL))
+    {
+        TESTVIDEOSYNC(OpenGLVideoSync)
+    }
 #endif
 #ifdef __linux__
     TESTVIDEOSYNC(RTCVideoSync)
diff -Naur mythtv-0.18.1-old/programs/mythbackend/mainserver.cpp mythtv-0.18.1-new/programs/mythbackend/mainserver.cpp
--- mythtv-0.18.1-old/programs/mythbackend/mainserver.cpp	2005-04-13 14:04:28.000000000 -0700
+++ mythtv-0.18.1-new/programs/mythbackend/mainserver.cpp	2005-11-19 07:20:37.000000000 -0800
@@ -589,6 +589,20 @@
 {
     QStringList retlist = "OK";
 
+    vector<PlaybackSock *>::iterator iter = playbackList.begin();
+    for (; iter != playbackList.end(); iter++)
+    {
+        PlaybackSock *pbs = (*iter);
+        if (pbs->getSocket() == socket)
+        {
+            VERBOSE(VB_ALL, QString("Client %1 is trying to announce a socket "
+                                    "multiple times.")
+                                    .arg(commands[2]));
+            WriteStringList(socket, retlist);
+            return;
+        }
+    }
+
     if (commands[1] == "Playback")
     {
         bool wantevents = commands[3].toInt();
diff -Naur mythtv-0.18.1-old/programs/mythfrontend/globalsettings.cpp mythtv-0.18.1-new/programs/mythfrontend/globalsettings.cpp
--- mythtv-0.18.1-old/programs/mythfrontend/globalsettings.cpp	2005-04-13 11:57:11.000000000 -0700
+++ mythtv-0.18.1-new/programs/mythfrontend/globalsettings.cpp	2005-11-19 07:20:37.000000000 -0800
@@ -2092,6 +2092,19 @@
     return gc;
 }
 
+#ifdef USING_OPENGL_VSYNC
+static HostCheckBox *UseOpenGLVSync()
+{
+    HostCheckBox *gc = new HostCheckBox("UseOpenGLVSync");
+    gc->setLabel(QObject::tr("Enable OpenGL vertical sync for timing"));
+    gc->setValue(false);
+    gc->setHelpText(QObject::tr("If it is supported by your hardware/drivers, "
+                    "MythTV will use OpenGL vertical syncing for video timing, reducing "
+                    "frame jitter."));
+    return gc;
+}
+#endif
+
 #ifdef USING_XVMC
 static HostCheckBox *UseXVMC()
 {
@@ -2135,6 +2148,10 @@
 
          addTarget("0", new VerticalConfigurationGroup(true));
 
+#ifdef USING_OPENGL_VSYNC
+         HostCheckBox *use_opengl_vsync = UseOpenGLVSync();
+         addChild(use_opengl_vsync);
+#endif
 #ifdef USING_XVMC
          addChild(UseXVMC());
 #endif
diff -Naur mythtv-0.18.1-old/programs/mythfrontend/mythfrontend.pro mythtv-0.18.1-new/programs/mythfrontend/mythfrontend.pro
--- mythtv-0.18.1-old/programs/mythfrontend/mythfrontend.pro	2005-01-30 22:14:20.000000000 -0800
+++ mythtv-0.18.1-new/programs/mythfrontend/mythfrontend.pro	2005-11-19 07:20:37.000000000 -0800
@@ -52,3 +52,8 @@
 macx {
     RC_FILE += mythfrontend.icns
 }
+
+using_opengl_vsync {
+    CONFIG += opengl
+    DEFINES += USING_OPENGL_VSYNC
+}
