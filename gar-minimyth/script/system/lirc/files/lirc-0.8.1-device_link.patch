diff -Naur lirc-0.8.1-old/drivers/lirc_atiusb/lirc_atiusb.c lirc-0.8.1-new/drivers/lirc_atiusb/lirc_atiusb.c
--- lirc-0.8.1-old/drivers/lirc_atiusb/lirc_atiusb.c	2006-10-19 22:03:38.000000000 -0700
+++ lirc-0.8.1-new/drivers/lirc_atiusb/lirc_atiusb.c	2007-02-12 20:09:42.000000000 -0800
@@ -980,6 +980,7 @@
 			plugin->rbuf = rbuf;
 			plugin->set_use_inc = &set_use_inc;
 			plugin->set_use_dec = &set_use_dec;
+			plugin->dev = &dev->dev;
 			plugin->owner = THIS_MODULE;
 			ir->usbdev = dev;
 			ir->p = plugin;
diff -Naur lirc-0.8.1-old/drivers/lirc_bt829/lirc_bt829.c lirc-0.8.1-new/drivers/lirc_bt829/lirc_bt829.c
--- lirc-0.8.1-old/drivers/lirc_bt829/lirc_bt829.c	2006-10-19 22:03:38.000000000 -0700
+++ lirc-0.8.1-new/drivers/lirc_bt829/lirc_bt829.c	2007-02-12 20:16:20.000000000 -0800
@@ -70,7 +70,7 @@
 
 static struct lirc_plugin atir_plugin;
 
-static int do_pci_probe(void)
+static struct pci_dev *do_pci_probe(void)
 {
 	struct pci_dev *my_dev;
 #ifndef KERNEL_2_5
@@ -90,13 +90,13 @@
 		}
 		if ( pci_addr_phys == 0 ) {
 			printk(KERN_ERR "ATIR no memory resource ?\n");
-			return 0;
+			return NULL;
 		}
 	} else {
 		printk(KERN_ERR "ATIR: pci_prob failed\n");
-		return 0;
+		return NULL;
 	}
-	return 1;
+	return my_dev;
 }
 
 static int atir_add_to_buf (void* data, struct lirc_buffer* buf)
@@ -129,7 +129,10 @@
 
 int init_module(void)
 {
-	if ( !do_pci_probe() ) {
+	struct pci_dev *pdev;
+
+	pdev = do_pci_probe();
+	if ( pdev == NULL ) {
 		return 1;
 	}
 
@@ -145,6 +148,7 @@
 	atir_plugin.add_to_buf  = atir_add_to_buf;
 	atir_plugin.set_use_inc = atir_set_use_inc;
 	atir_plugin.set_use_dec = atir_set_use_dec;
+	atir_plugin.dev         = &pdev->dev;
 	atir_plugin.owner       = THIS_MODULE;
 
 	atir_minor = lirc_register_plugin(&atir_plugin);
diff -Naur lirc-0.8.1-old/drivers/lirc_cmdir/lirc_cmdir.c lirc-0.8.1-new/drivers/lirc_cmdir/lirc_cmdir.c
--- lirc-0.8.1-old/drivers/lirc_cmdir/lirc_cmdir.c	2006-10-19 22:03:38.000000000 -0700
+++ lirc-0.8.1-new/drivers/lirc_cmdir/lirc_cmdir.c	2007-02-12 20:09:55.000000000 -0800
@@ -572,6 +572,7 @@
 	set_use_dec:	set_use_dec,
 	ioctl:		lirc_ioctl,
 	fops:		&lirc_fops,
+	dev:		NULL,
 	owner:		THIS_MODULE,
 };
 
diff -Naur lirc-0.8.1-old/drivers/lirc_dev/lirc_dev.c lirc-0.8.1-new/drivers/lirc_dev/lirc_dev.c
--- lirc-0.8.1-old/drivers/lirc_dev/lirc_dev.c	2006-12-29 02:00:07.000000000 -0800
+++ lirc-0.8.1-new/drivers/lirc_dev/lirc_dev.c	2007-02-12 20:10:11.000000000 -0800
@@ -380,7 +380,7 @@
 #endif
 	(void) lirc_class_device_create(lirc_class, NULL, 
 					MKDEV(IRCTL_DEV_MAJOR, ir->p.minor),
-					NULL, "lirc%u", ir->p.minor);
+					ir->p.dev, "lirc%u", ir->p.minor);
 
 	if(p->sample_rate || p->get_queue) {
 		/* try to fire up polling thread */
diff -Naur lirc-0.8.1-old/drivers/lirc_dev/lirc_dev.h lirc-0.8.1-new/drivers/lirc_dev/lirc_dev.h
--- lirc-0.8.1-old/drivers/lirc_dev/lirc_dev.h	2006-09-21 20:18:22.000000000 -0700
+++ lirc-0.8.1-new/drivers/lirc_dev/lirc_dev.h	2007-02-12 16:12:26.000000000 -0800
@@ -22,6 +22,7 @@
 #endif
 #include <linux/slab.h>
 #include <linux/fs.h>
+#include <linux/device.h>
 struct lirc_buffer
 {
         wait_queue_head_t wait_poll;
@@ -168,6 +169,7 @@
 	int (*ioctl) (struct inode *,struct file *,unsigned int,
 		      unsigned long);
 	struct file_operations *fops;
+	struct device *dev;
 	struct module *owner;
 };
 /* name:
diff -Naur lirc-0.8.1-old/drivers/lirc_gpio/lirc_gpio.c lirc-0.8.1-new/drivers/lirc_gpio/lirc_gpio.c
--- lirc-0.8.1-old/drivers/lirc_gpio/lirc_gpio.c	2006-07-05 23:42:44.000000000 -0700
+++ lirc-0.8.1-new/drivers/lirc_gpio/lirc_gpio.c	2007-02-12 20:10:20.000000000 -0800
@@ -377,6 +377,7 @@
 	.get_queue	= get_queue,
 	.set_use_inc	= set_use_inc,
 	.set_use_dec	= set_use_dec,
+	.dev		= NULL,
 	.owner          = THIS_MODULE,
 };
 
diff -Naur lirc-0.8.1-old/drivers/lirc_i2c/lirc_i2c.c lirc-0.8.1-new/drivers/lirc_i2c/lirc_i2c.c
--- lirc-0.8.1-old/drivers/lirc_i2c/lirc_i2c.c	2006-06-26 16:21:34.000000000 -0700
+++ lirc-0.8.1-new/drivers/lirc_i2c/lirc_i2c.c	2007-02-12 20:10:28.000000000 -0800
@@ -348,6 +348,7 @@
 	name:        "lirc_i2c",
 	set_use_inc: set_use_inc,
 	set_use_dec: set_use_dec,
+	dev:         NULL,
 	owner:       THIS_MODULE
 };
 
diff -Naur lirc-0.8.1-old/drivers/lirc_igorplugusb/lirc_igorplugusb.c lirc-0.8.1-new/drivers/lirc_igorplugusb/lirc_igorplugusb.c
--- lirc-0.8.1-old/drivers/lirc_igorplugusb/lirc_igorplugusb.c	2006-10-19 22:03:38.000000000 -0700
+++ lirc-0.8.1-new/drivers/lirc_igorplugusb/lirc_igorplugusb.c	2007-02-12 20:10:37.000000000 -0800
@@ -505,6 +505,7 @@
 			plugin->set_use_dec = &set_use_dec;
 			plugin->sample_rate = SAMPLE_RATE;    /* per second */
 			plugin->add_to_buf = &usb_remote_poll;
+			plugin->dev = &dev->dev;
 			plugin->owner = THIS_MODULE;
 
 			init_MUTEX(&ir->lock);
diff -Naur lirc-0.8.1-old/drivers/lirc_imon/lirc_imon.c lirc-0.8.1-new/drivers/lirc_imon/lirc_imon.c
--- lirc-0.8.1-old/drivers/lirc_imon/lirc_imon.c	2006-12-29 02:00:07.000000000 -0800
+++ lirc-0.8.1-new/drivers/lirc_imon/lirc_imon.c	2007-02-12 20:10:44.000000000 -0800
@@ -1009,6 +1009,7 @@
 		plugin ->rbuf = rbuf;
 		plugin ->set_use_inc = ir_open;
 		plugin ->set_use_dec = ir_close;
+		plugin->dev = &dev->dev;
 		plugin->owner = THIS_MODULE;
 
 		LOCK_CONTEXT;
diff -Naur lirc-0.8.1-old/drivers/lirc_it87/lirc_it87.c lirc-0.8.1-new/drivers/lirc_it87/lirc_it87.c
--- lirc-0.8.1-old/drivers/lirc_it87/lirc_it87.c	2006-10-19 22:03:38.000000000 -0700
+++ lirc-0.8.1-new/drivers/lirc_it87/lirc_it87.c	2007-02-12 20:10:50.000000000 -0800
@@ -407,6 +407,7 @@
        set_use_inc:    set_use_inc,
        set_use_dec:    set_use_dec,
        fops:           &lirc_fops,
+       dev:            NULL,
        owner:	       THIS_MODULE,
 };
 
diff -Naur lirc-0.8.1-old/drivers/lirc_mceusb/lirc_mceusb.c lirc-0.8.1-new/drivers/lirc_mceusb/lirc_mceusb.c
--- lirc-0.8.1-old/drivers/lirc_mceusb/lirc_mceusb.c	2006-10-19 22:03:38.000000000 -0700
+++ lirc-0.8.1-new/drivers/lirc_mceusb/lirc_mceusb.c	2007-02-12 20:11:06.000000000 -0800
@@ -861,6 +861,7 @@
 	plugin->sample_rate = 80;   // sample at 100hz (10ms)
 	plugin->add_to_buf  = &mceusb_add_to_buf;
 	//    plugin->fops        = &mceusb_fops;
+	plugin->dev         = &udev->dev;
 	plugin->owner       = THIS_MODULE;
 	if( lirc_register_plugin(plugin) < 0 )
 	{
diff -Naur lirc-0.8.1-old/drivers/lirc_mceusb2/lirc_mceusb2.c lirc-0.8.1-new/drivers/lirc_mceusb2/lirc_mceusb2.c
--- lirc-0.8.1-old/drivers/lirc_mceusb2/lirc_mceusb2.c	2006-11-30 20:28:01.000000000 -0800
+++ lirc-0.8.1-new/drivers/lirc_mceusb2/lirc_mceusb2.c	2007-02-12 20:10:57.000000000 -0800
@@ -722,6 +722,7 @@
 			plugin->code_length = sizeof(lirc_t) * 8;
 			plugin->ioctl = lirc_ioctl;
 			plugin->fops  = &lirc_fops;
+			plugin->dev   = &dev->dev;
 			plugin->owner = THIS_MODULE;
 
 			init_MUTEX(&ir->lock);
diff -Naur lirc-0.8.1-old/drivers/lirc_parallel/lirc_parallel.c lirc-0.8.1-new/drivers/lirc_parallel/lirc_parallel.c
--- lirc-0.8.1-old/drivers/lirc_parallel/lirc_parallel.c	2006-10-19 22:03:38.000000000 -0700
+++ lirc-0.8.1-new/drivers/lirc_parallel/lirc_parallel.c	2007-02-12 20:11:09.000000000 -0800
@@ -639,6 +639,7 @@
        set_use_inc:    set_use_inc,
        set_use_dec:    set_use_dec,
        fops:           &lirc_fops,
+       dev:            NULL,
        owner:          THIS_MODULE,
 };
 
diff -Naur lirc-0.8.1-old/drivers/lirc_sasem/lirc_sasem.c lirc-0.8.1-new/drivers/lirc_sasem/lirc_sasem.c
--- lirc-0.8.1-old/drivers/lirc_sasem/lirc_sasem.c	2006-12-29 02:00:07.000000000 -0800
+++ lirc-0.8.1-new/drivers/lirc_sasem/lirc_sasem.c	2007-02-12 20:11:16.000000000 -0800
@@ -894,6 +894,7 @@
 		plugin ->rbuf = rbuf;
 		plugin ->set_use_inc = ir_open;
 		plugin ->set_use_dec = ir_close;
+		plugin->dev   = &dev->dev;
 		plugin->owner = THIS_MODULE;
 
 		LOCK_CONTEXT;
diff -Naur lirc-0.8.1-old/drivers/lirc_serial/lirc_serial.c lirc-0.8.1-new/drivers/lirc_serial/lirc_serial.c
--- lirc-0.8.1-old/drivers/lirc_serial/lirc_serial.c	2006-12-27 12:59:25.000000000 -0800
+++ lirc-0.8.1-new/drivers/lirc_serial/lirc_serial.c	2007-02-12 20:11:18.000000000 -0800
@@ -1141,6 +1141,7 @@
 	set_use_dec:	set_use_dec,
 	ioctl:		lirc_ioctl,
 	fops:		&lirc_fops,
+	dev:		NULL,
 	owner:		THIS_MODULE,
 };
 
diff -Naur lirc-0.8.1-old/drivers/lirc_sir/lirc_sir.c lirc-0.8.1-new/drivers/lirc_sir/lirc_sir.c
--- lirc-0.8.1-old/drivers/lirc_sir/lirc_sir.c	2006-10-19 22:03:39.000000000 -0700
+++ lirc-0.8.1-new/drivers/lirc_sir/lirc_sir.c	2007-02-12 20:11:23.000000000 -0800
@@ -537,6 +537,7 @@
        set_use_inc:    set_use_inc,
        set_use_dec:    set_use_dec,
        fops:           &lirc_fops,
+       dev:            NULL,
        owner:          THIS_MODULE,
 };
 
diff -Naur lirc-0.8.1-old/drivers/lirc_streamzap/lirc_streamzap.c lirc-0.8.1-new/drivers/lirc_streamzap/lirc_streamzap.c
--- lirc-0.8.1-old/drivers/lirc_streamzap/lirc_streamzap.c	2006-11-30 20:11:52.000000000 -0800
+++ lirc-0.8.1-new/drivers/lirc_streamzap/lirc_streamzap.c	2007-02-12 20:11:34.000000000 -0800
@@ -605,6 +605,7 @@
 	sz->plugin.set_use_inc = &streamzap_use_inc;
 	sz->plugin.set_use_dec = &streamzap_use_dec;
 	sz->plugin.ioctl = streamzap_ioctl;
+	sz->plugin.dev = &udev->dev;
 	sz->plugin.owner = THIS_MODULE;
 
 	sz->idle = 1;
