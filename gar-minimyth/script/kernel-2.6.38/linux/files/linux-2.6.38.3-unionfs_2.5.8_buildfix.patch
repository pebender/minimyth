diff -Naur linux-2.6.38.3-old/fs/unionfs/commonfops.c linux-2.6.38.3-new/fs/unionfs/commonfops.c
--- linux-2.6.38.3-old/fs/unionfs/commonfops.c	2011-04-17 12:59:56.000000000 -0700
+++ linux-2.6.38.3-new/fs/unionfs/commonfops.c	2011-04-17 13:00:37.000000000 -0700
@@ -16,6 +16,7 @@
  * published by the Free Software Foundation.
  */
 
+#include <linux/compat.h>
 #include "union.h"
 
 /*
@@ -740,9 +741,8 @@
 	if (lower_file->f_op->unlocked_ioctl) {
 		err = lower_file->f_op->unlocked_ioctl(lower_file, cmd, arg);
 #ifdef CONFIG_COMPAT
-	} else if (lower_file->f_op->ioctl) {
+	} else if (lower_file->f_op->compat_ioctl) {
 		err = lower_file->f_op->compat_ioctl(
-			lower_file->f_path.dentry->d_inode,
 			lower_file, cmd, arg);
 #endif
 	}
