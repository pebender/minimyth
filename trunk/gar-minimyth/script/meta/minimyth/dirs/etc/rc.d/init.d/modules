#!/bin/sh
################################################################################
# modules
################################################################################
. /etc/rc.d/functions

start() {
    mm_message_output info 'loading kernel modules ...'

    # ACPI.
    modprobe button
    modprobe fan
    modprobe processor
    modprobe thermal
    modprobe video

    # CPU Frequency Scaling.
    case "${MM_HARDWARE_CPU}" in
        ATHLON64)
            modprobe powernow-k8
            ;;
        C3|C3-2)
            modprobe longhaul
            ;;
    esac
    case "${MM_CPUFREQ_GOVERNOR}" in
        performance)
            ;;
        powersave)
            modprobe cpufreq-powersave
            ;;
        ondemand)
            modprobe cpufreq-ondemand
            ;;
        conservative)
            modprobe cpufreq-conservative
            ;;
        userspace)
            modprobe cpufreq-userspace
            ;;
    esac

    # Real time clock.
    modprobe rtc

    # Input.
    modprobe evdev
    modprobe psmouse

    # Sensors.
    case "${MM_HARDWARE_SENSOR}" in
        VIA_VT1211)
            modprobe i2c-core
            modprobe i2c-dev
            modprobe i2c-isa
            modprobe vt1211
            ;;
        WINBOND_W83627EHG)
            modprobe i2c-core
            modprobe i2c-dev
            modprobe i2c-isa
            case "${MM_HARDWARE_SOUTHBRIDGE}" in
                NVIDIA_NFORCE430)
                    modprobe i2c-nforce2
                    ;;
            esac
            modprobe w83627ehf
            ;;
        WINBOND_W83782D)
            modprobe i2c-core
            modprobe i2c-dev
            modprobe i2c-isa
            case "${MM_HARDWARE_SOUTHBRIDGE}" in
                VIA_VT8235|VIA_VT8237)
                    modprobe i2c-viapro
                    ;;
            esac
            modprobe w83781d
            ;;
    esac

    # IO scheduler.
    modprobe as-iosched

    # Loopback device.
    modprobe loop

    # IDE.
    case "${MM_HARDWARE_SOUTHBRIDGE}" in
        INTEL_ICH4)
            modprobe piix
            ;;
        NVIDIA_NFORCE430)
            modprobe amd74xx
            ;;
        VIA_VT8235|VIA_VT8237)
            modprobe via82cxxx
            ;;
    esac
    modprobe ide-core
    modprobe ide-cd

    # IEEE1394 (firewire).
    modprobe ieee1394
    modprobe ohci1394
    modprobe sbp2

    # Parallel port.
    modprobe parport
    modprobe parport_pc
    modprobe ppdev

    # USB.
    modprobe usbcore
    modprobe ehci-hcd
    case "${MM_HARDWARE_SOUTHBRIDGE}" in
        INTEL_ICH4)
            modprobe uhci-hcd
            ;;
        NVIDIA_NFORCE430)
            modprobe ohci-hcd
            ;;
        VIA_VT8235|VIA_VT8237)
            modprobe uhci-hcd
            ;;
    esac
    modprobe usbhid
    modprobe usblcd
    modprobe usb-storage
    modprobe usbserial
    modprobe ftdi-sio

    # SCSI (used by USB devices).
    modprobe sd_mod
    modprobe sr_mod

    # CD-ROM.
    modprobe cdrom

    # File systems.
    modprobe nls_ascii
    modprobe nls_base
    modprobe nls_cp437
    modprobe nls_cp850
    modprobe nls_iso8859-1
    modprobe nls_iso8859-15
    modprobe nls_utf8
    modprobe cifs
    modprobe fat
    modprobe isofs
    modprobe msdos
    modprobe udf
    modprobe vfat

    # Net.
    modprobe af_packet

    # Sound.
    modprobe soundcore
    case "${MM_HARDWARE_AUDIO}" in
        ANALOG_AD1986A)
            modprobe snd-hda-intel
            ;;
        REALTEK_ALC655)
            modprobe snd-intel8x0
            ;;
        VIA_VT1612A|VIA_VT1616|VIA_VT1617A)
            modprobe snd-via82xx
            ;;
    esac

    # Video.
    modprobe agpgart
    case "${MM_HARDWARE_NORTHBRIDGE}" in
        INTEL_845GV)
            modprobe intel-agp
            ;;
        NVIDIA_GFORCE6150)
            modprobe nvidia-agp
            ;;
        VIA_CLE266|VIA_CN400)
            modprobe via-agp
            ;;
    esac
    case "${MM_X_DRIVER}" in
        intel_810)
            modprobe i810
            ;;
        intel_830)
            modprobe i830
            ;;
        intel_915)
            modprobe i915
            ;;
        nvidia)
            modprobe nvidia
            ;;
        via)
            modprobe via
            ;;
    esac

    return 0
}

stop() {
    return 0
}

case $1 in
    start) start ;;
    stop)  stop  ;;
esac

exit 0
