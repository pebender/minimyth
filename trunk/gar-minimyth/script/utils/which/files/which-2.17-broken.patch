diff -Naur which-2.17-old/tilde/tilde.c which-2.17-new/tilde/tilde.c
--- which-2.17-old/tilde/tilde.c	2005-04-21 07:29:38.000000000 -0700
+++ which-2.17-new/tilde/tilde.c	2007-10-12 11:18:35.000000000 -0700
@@ -182,7 +182,10 @@
   int result_size, result_index;
 
   result_index = result_size = 0;
-  if (result = strchr (string, '~'))
+
+  result = strchr (string, '~');
+  
+  if (!result)
     result = xmalloc (result_size = (strlen (string) + 16));
   else
     result = xmalloc (result_size = (strlen (string) + 1));
diff -Naur which-2.17-old/which.c which-2.17-new/which.c
--- which-2.17-old/which.c	2007-10-09 07:19:27.000000000 -0700
+++ which-2.17-new/which.c	2007-10-12 11:18:35.000000000 -0700
@@ -22,6 +22,7 @@
 #include "getopt.h"
 #include "tilde/tilde.h"
 #include "bash.h"
+#include <ctype.h>
 
 static const char *progname;
 
