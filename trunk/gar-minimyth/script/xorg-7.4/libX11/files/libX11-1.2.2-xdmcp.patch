diff -Naur libX11-1.2.2-old/configure.ac libX11-1.2.2-new/configure.ac
--- libX11-1.2.2-old/configure.ac	2009-07-10 06:42:33.000000000 -0700
+++ libX11-1.2.2-new/configure.ac	2009-07-10 06:43:02.000000000 -0700
@@ -54,9 +54,18 @@
 case "$ac_cv_use_xcb" in
 no)
 	X11_REQUIRES="xau xcmiscproto bigreqsproto"
-	X11_EXTRA_DEPS="xau xdmcp"
-	PKG_CHECK_MODULES(XDMCP, xdmcp)
-	AC_CHECK_LIB(Xdmcp, XdmcpWrap, [xdmauth="yes"], [xdmauth="no"], [$XDMCP_LIBS])
+ 	X11_EXTRA_DEPS="xau"
+ 	PKG_CHECK_MODULES(XDMCP, xdmcp,
+ 		AC_CHECK_LIB(Xdmcp, XdmcpWrap,
+ 			[
+ 	        	AC_CHECK_LIB(Xdmcp, XdmcpWrap, [xdmauth="yes"], [xdmauth="no"], [$XDMCP_LIBS])
+ 	        	X11_EXTRA_DEPS="$X11_EXTRA_DEPS xdmcp"
+ 			],
+ 			[
+ 			XDMCP_CFLAGS=
+ 			XDMCP_LIBS=
+ 			], [$XDMCP_LIBS]),
+ 		[AC_MSG_RESULT(no)])
 	AC_DEFINE(USE_XCB, 0, [Use XCB for low-level protocol implementation])
 	;;
 *)
diff -Naur libX11-1.2.2-old/src/ConnDis.c libX11-1.2.2-new/src/ConnDis.c
--- libX11-1.2.2-old/src/ConnDis.c	2009-07-10 06:42:17.000000000 -0700
+++ libX11-1.2.2-new/src/ConnDis.c	2009-07-10 06:43:02.000000000 -0700
@@ -39,7 +39,9 @@
 #include <X11/Xlibint.h>
 #include <X11/Xtrans/Xtrans.h>
 #include <X11/Xauth.h>
+#ifdef HASXDMAUTH
 #include <X11/Xdmcp.h>
+#endif
 #include <stdio.h>
 #include <ctype.h>
 #include <unistd.h>
